<?xml version="1.0" encoding="UTF-8"?>

<!--
   - Filename:     moves.xml
   - Description:
   -
   - (c) COPYRIGHT Queen City Software, Inc. 2017 All Rights Reserved
   - No part of this copyrighted work may be reproduced, modified, or
   - distributed in any form or by any means without the prior written
   - permission of Queen City Software, Inc.
   -
   - $Id: moves.xml 9887 2018-03-07 18:58:07Z rlh $
   - Notes:
  -->
<FLEXSCREEN
  title="Moves"
  height="768"
  width="1024"
  frametype="internal"
  updateSecurity="moves.edit"
  insertSecurity="moves.edit"
  deleteSecurity="moves.delete">

  <DBCONNECT
    type="predefined"
    connectionId="default"
    setglobal="true" />
  <GLOBAL_DEFINITIONS>
    <VECTOR
      name="unitTypes"
      loadSql="select distinct unitType 
                          from UnitMasters
                         where unitType in ('EACH')" />

    <VECTOR
      name="moveTypes"
      loadSql="SELECT distinct workOrderType 
                        from WorkOrders
                        where workOrderType in ('MOVE','REPLEN','PUTAWAY')" />

    <VECTOR
      name="emptyStatuses"
      loadSql="Select ' ' mnemoniccode" />

    <VECTOR
      name="replenWorkStatuses"
      loadSql="Select returnCodeMsg 
                          from MnemonicCodesView 
                         where mnemonicType = 'REPLEN_WO_STATUSES'
                         ORDER BY idx" />

    <VECTOR
      name="moveWorkStatuses"
      loadSql="select returnCodeMsg 
                          from MnemonicCodesView 
                         where mnemonicType = 'MOVE_WO_STATUSES'
                          ORDER BY idx" />

    <VECTOR
      name="putawayWorkStatuses"
      loadSql="Select returnCodeMsg
                          from MnemonicCodesView 
                         where mnemonicType = 'PUTAWAY_WO_STATUSES'
                         ORDER BY idx" />

    <VECTOR
      name="cartStatus"
      loadSql="select returnCodeMsg 
                 from MnemonicCodesView
                where mnemonicType = 'MOVEABLE_UNIT_CLUSTER_STATUSES'
               order by case when
							       returnCodeMsg = 'Available to load'
							       then 1 else 2 end,
							       returnCodeMsg" />
                         
                             
    <VECTORMAP name    = "truckStatusMap"
               loadSql = "SELECT idx, returnCodeMsg
                            FROM MnemonicCodesView
                           WHERE mnemonicType = 'MOVEABLE_UNIT_CLUSTER_STATUSES'
                           ORDER BY idx" />
   
  </GLOBAL_DEFINITIONS>

  <TABPANE>
	  <TAB title="Moves">
		  <SPLITPANE
		    divider="145"
		    orientation="vertical">
		    <FLEXSQLMODIFIERCOMPONENT
		      name="MovesFilter"
		      appendAsAnd="false"
		      makeAbsolute="true"
		      autoResize="false"
		      autoExecute="true"
		      labelsOnTop="false"
		      maxFilterRows="3"
		      editorWidth="150"
		      showCheckBoxes="false"
		      filterBorderText="Filter Criteria"
		      filterBorderColor="blue"
		      okButtonText="Execute"
		      passiveMode="false"
		      orientation="horizontal"
		      roundedCorners="true">
		
		      <DBCONNECT
		        type="global"
		        connectionId="default" />
		
		      <FILTER_OPTION
		        label="Order"
		        altValue="Order"
		        editorType="text"
		        autoQuote="true">
		      </FILTER_OPTION>
		
		      <FILTER_OPTION
		        label="Pallet Id"
		        altValue="PalletId"
		        editorType="text"
		        autoQuote="true">
		      </FILTER_OPTION>
		
		      <FILTER_OPTION
		        label="Location"
		        altValue="Location"
		        editorType="text"
		        autoQuote="true">
		      </FILTER_OPTION>
		
		      <FILTER_OPTION
		        label="Gid"
		        altValue="Gid"
		        editorType="text"
		        autoQuote="true">
		      </FILTER_OPTION>
		
		      <FILTER_OPTION
		        label="Unit Type"
		        altValue="UnitType"
		        editorType="combo"
		        autoQuote="true">
		        <COMBO_OPTIONS ifdef="unitTypes" />
		      </FILTER_OPTION>
		
		      <FILTER_OPTION
		        label="MoveType"
		        altValue="MoveType"
		        editorType="custom"
		        autoQuote="true">
		        <COMMAND_COMBO
		          name="MoveType"
		          editable="false">
		          <Model
		            name="moveType"
		            ifdef="moveTypes"
		            loadEmptyItem="true" />
		        </COMMAND_COMBO>
		      </FILTER_OPTION>
		
		      <FILTER_OPTION
		        label="Status"
		        altValue="Status"
		        editorType="custom"
		        autoQuote="true">
		        <COMMAND_COMBO
		          name="Status"
		          editable="false">
		          <TRIGGER name="MoveType" />
		          <Model
		            name=""
		            ifdef="emptyStatuses"
		            loadEmptyItem="true" />
		          <Model
		            name="MOVE"
		            ifdef="moveWorkStatuses"
		            loadEmptyItem="true" />
		          <Model
		            name="REPLEN"
		            ifdef="replenWorkStatuses"
		            loadEmptyItem="true" />
		          <Model
		            name="PUTAWAY"
		            ifdef="putawayWorkStatuses"
		            loadEmptyItem="true" />
		        </COMMAND_COMBO>
		      </FILTER_OPTION>
		
		      <FILTER_OPTION
		        label="Operator"
		        altValue="Operator"
		        editorType="text"
		        autoQuote="true">
		      </FILTER_OPTION>
		    </FLEXSQLMODIFIERCOMPONENT>
		
		    <SPLITPANE
		      divider="300"
		      orientation="vertical">
		      <FLEXTABLECOMPONENT
		        name="DescriptionTable"
		        greenbar="true"
		        records="1000"
		        refresh="true"
		        refreshOnUpdate="true">
		        <TRIGGER name="MovesFilter" />
		        <TRIGGER name="MoveCancelPanel" />
		        <DBCONNECT type="global" />
		        <TABLE key="MovesFilter:execute">
		          <SELECT
		            sql="call BoxedMovesScreen(
		                                       //Order,
		                                       //PalletId,
		                                       //Location,
		                                       //Gid,
		                                       //UnitType,
		                                       //MoveType,
		                                       //Status,
		                                       //Operator
		                                       )" />
		
		          <UPDATE
		            sql="call MoveOperatorUpdate(
		                                         //PalletId,
		                                         //MoveType,
		                                         //Operator,
		                                         //CartStatus)" />
		                                         
		          <INSERT
		            sql="insert into MoveableUnitClusters(clusterId, zoneId, flags, status)
		                                          values(//PalletId, 'AVAILCARTS', 6, 20)"/> 
		
		          <EDITOR
		            restoreHide="true"
		            title="Moves"
		            saveText="Save"
		            cancelText="Cancel">
		            <FIELD name="Order">
		              <TEXTFIELD cutpaste="true" />
		            </FIELD>
		            <FIELD name="CurrentLoc">
		              <TEXTFIELD cutpaste="true" />
		            </FIELD>
		            <FIELD name="PalletId">
		              <TEXTFIELD cutpaste="true" />
		            </FIELD>
		            <FIELD name="unit">
		              <TEXTFIELD cutpaste="true" />
		            </FIELD>
		            <FIELD name="UnitType">
		              <TEXTFIELD cutpaste="true" />
		            </FIELD>
		            <FIELD name="MoveType">
		              <TEXTFIELD cutpaste="true" />
		            </FIELD>
		            <FIELD name="Operator">
		              <TEXTFIELD cutpaste="true" />
		            </FIELD>
		            <FIELD name="Status">
		              <TEXTFIELD cutpaste="true" />
		            </FIELD>
		            <FIELD name="CartStatus">
		              <COMBO ifdef="cartStatus" />
		            </FIELD>
		            <FIELD name="StorageType">
		              <TEXTFIELD cutpaste="true" />
		            </FIELD>
		            <FIELD name="Ts">
		              <TEXTFIELD cutpaste="true" />
		            </FIELD>
		          </EDITOR>
		
		          <TABLECOLUMNS>
		            <TABLECOLUMN
		              name="Storage Id"
		              hide="true" />
		          </TABLECOLUMNS>
		        </TABLE>
		      </FLEXTABLECOMPONENT>
		
		      <SPLITPANE
		        divider="180"
		        orientation="vertical">
		        <FLEXTABLECOMPONENT
		          name="ContentTable"
		          greenbar="true"
		          records="1000">
		          <TRIGGER name="DescriptionTable" />
		          <DBCONNECT type="global" />
		          <TABLE key="DescriptionTable:MovesFilter:execute">
		            <SELECT
		              sql="call MoveContents(
		                                           //WorkOrderId,
		                                           //StorageId,
		                                           //MoveType,
		                                           //Gid)" />
		            <TABLECOLUMNS>
		              <TABLECOLUMN
		                name="Order"
		                hide="true" />
		              <TABLECOLUMN
		                name="UnitType"
		                hide="true" />
		            </TABLECOLUMNS>
		          </TABLE>
		        </FLEXTABLECOMPONENT>
		
		        <FLEXBUTTONPANEL
		          name="MoveCancelPanel"
		          rows="1"
		          columns="1"
		          pad="3"
		          verticalBorder="10"
		          horizontalBorder="100"
		          autoCommit="true"
		          handleResult="true"
		          messageMode="popup"
		          parentRequired="true"
		          enableWarning="false">
		          <DBCONNECT type="global" />
		          <TRIGGER name="ContentTable" />
		          <BUTTON
		            name="dummy1"
		            visible="false" />
		          <BUTTON
		            name="Cancel"
		            text="Cancel Move"
		            foreground="blue"
		            securityId="moves.edit"
		            action="refresh">
		            <FLEXACTION class="com.qcsoftware.boxed.ui.MoveCancelAction">
		              <ARGUEMENTS
		                procedure="BoxedMovesValidateReturnInventory"
		                returnsLocation=" " />
		            </FLEXACTION>
		          </BUTTON>
		          <BUTTON
		            name="dummy1"
		            visible="false" />
		        </FLEXBUTTONPANEL>
		      </SPLITPANE>
		    </SPLITPANE>
		  </SPLITPANE>
	  </TAB>
	  <TAB title="Trucks">
      <SPLITPANE
        divider="100"
        orientation="vertical">
        <FLEXSQLMODIFIERCOMPONENT
          name="TrucksFilter"
          appendAsAnd="false"
          makeAbsolute="true"
          autoResize="false"
          autoExecute="true"
          labelsOnTop="false"
          maxFilterRows="1"
          editorWidth="150"
          showCheckBoxes="false"
          filterBorderText="Filter Criteria"
          filterBorderColor="blue"
          okButtonText="Execute"
          passiveMode="false"
          orientation="horizontal"
          roundedCorners="true">
    
          <DBCONNECT
            type="global"
            connectionId="default" />
    
          <FILTER_OPTION
            label="Truck"
            altValue="Truck"
            editorType="text"
            autoQuote="true">
          </FILTER_OPTION>
        </FLEXSQLMODIFIERCOMPONENT>
        <FLEXTABLECOMPONENT
            name="CartTable"
            init = "initMe"
            greenbar="true"
            records="50"
            refresh="true"
            refreshOnUpdate="true">
            <TRIGGER name="TrucksFilter" />
            <DBCONNECT type="global" />
            <TABLE key="initMe">
              <SELECT
                sql="select clusterId  Truck
										       , zoneId     Zone
										       , locationId Location
										       , status     Status
										       , operatorId Operator
										       , ts         Ts
										    from MoveableUnitClusters
										   where flags &amp; gMuClusterPermanent &gt; 0
										   order by clusterId" />
    
              <UPDATE
                sql="&#xA;call MoveTruckUpdate(//Truck,
                     &#xA;                     //Status,
                     &#xA;                     //Operator)" />
                                             
              <INSERT
                sql="&#xA;insert into MoveableUnitClusters(clusterId, zoneId, flags, status)
                     &#xA;            values(//Truck, 'AVAILCARTS', 6, 20)"/>
                     
              <ALTVALUES>
                <FIELD name = "Status"
                       ifdef = "truckStatusMap" />
              </ALTVALUES> 
    
              <EDITOR
                restoreHide="true"
                title="Truck"
                saveText="Save"
                cancelText="Cancel">
                <FIELD name="Truck">
                  <TEXTFIELD cutpaste="true" />
                </FIELD>
                <FIELD name="Status">
                  <COMBO ifdef="cartStatus" />
                </FIELD>
                <FIELD name="Operator">
                  <TEXTFIELD cutpaste="true" />
                </FIELD>
              </EDITOR>
            </TABLE>
            <TABLE key="TrucksFilter:execute">
              <SELECT
                sql="&#xA;call MoveGetTruck(//Truck)" />
    
              <UPDATE
                sql="&#xA;call MoveTruckUpdate(//Truck,
                     &#xA;                     //Status,
                     &#xA;                     //Operator)" />
                                             
              <INSERT
                sql="&#xA;insert into MoveableUnitClusters(clusterId, zoneId, flags, status)
                     &#xA;            values(//Truck, 'AVAILCARTS', 6, 20)"/>
                     
              <ALTVALUES>
                <FIELD name = "Status"
                       ifdef = "truckStatusMap" />
              </ALTVALUES> 
    
              <EDITOR
                restoreHide="true"
                title="Truck"
                saveText="Save"
                cancelText="Cancel">
                <FIELD name="Truck">
                  <TEXTFIELD cutpaste="true" />
                </FIELD>
                <FIELD name="Status">
                  <COMBO ifdef="cartStatus" />
                </FIELD>
                <FIELD name="Operator">
                  <TEXTFIELD cutpaste="true" />
                </FIELD>
              </EDITOR>
            </TABLE>
          </FLEXTABLECOMPONENT>
       </SPLITPANE>
	  </TAB>
  </TABPANE>
</FLEXSCREEN>