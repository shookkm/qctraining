<?xml version="1.0"?>
<!--
   - Filename:     inventoryMaintenance.xml
   - Description:
   -
   - (c) COPYRIGHT Queen City Software, Inc. 2011 All Rights Reserved
   - No part of this copyrighted work may be reproduced, modified, or
   - distributed in any form or by any means without the prior written
   - permission of Queen City Software, Inc.
   -
   - $Id: inventoryMaintenance.xml 9954 2018-03-28 11:38:36Z rlh $
   - Notes:
  -->

<FLEXSCREEN title = "Inventory Maintenance" 
            height = "600" 
            width = "1000" 
            frametype = "internal"
            report = "true"
            updateSecurity = "inventoryMaintenance.edit" >

  <!-- a dbConnect here is a universal connect object  -->
  <DBCONNECT type = "predefined" 
             connectionId = "default" 
             setglobal = "true"/>

  <GLOBAL_DEFINITIONS>
    <VECTORMAP
      name="inventoryStatusesMap"
      loadSql="&#xA;select idx
               &#xA;     , returnCodeMsg 
               &#xA;  from MnemonicCodesView 
               &#xA; where mnemonicType = 'INVENTORY_STATUSES' 
               &#xA; order by idx" />

    <VECTORMAP
      name="inventoryDiscrepantMap"
      loadSql="&#xA;select gInventoryDiscrepancyFlag, 'Yes' 
               &#xA; union
               &#xA;select 0, 'No'" />

    <VECTORMAP
      name="inventoryAdjustmentCodesMap"
      loadSql="&#xA;select idx
               &#xA;     , returnCodeMsg 
               &#xA;  from MnemonicCodesView 
               &#xA; where mnemonicType = 'INVENTORY_ADJUSTMENT_CODES'
               &#xA;   and mnemonicCode != 'CYCLECOUNT'
               &#xA; order by idx" />

    <VECTOR name = "inventoryStatuses"
               loadSql = "select returnCodeMsg 
                            from MnemonicCodesView 
                            where mnemonicType = 'INVENTORY_STATUSES' 
                            order by idx" />

    <VECTOR name = "inventoryAdjustmentCodes"
               loadSql = "select returnCodeMsg 
                            from MnemonicCodesView 
                            where mnemonicType = 'INVENTORY_ADJUSTMENT_CODES'
                              and mnemonicCode != 'CYCLECOUNT'
                            order by idx" />

    <VECTORMAP name = "locationStatuses"
               loadSql = "select idx, 
                                 returnCodeMsg 
                            from MnemonicCodesView 
                            where mnemonicType = 'LOCATION_STATUSES'
                            order by idx" />

    <VECTORMAP name = "clusterStatuses"
               loadSql = "select idx, 
                                 returnCodeMsg 
                            from MnemonicCodesView 
                            where mnemonicType = 'MOVEABLE_UNIT_CLUSTER_STATUSES' 
                            order by idx" />
                            
    <VECTORMAP name = "muClusterFlags"
               loadSql = "select idx, 
                                 returnCodeMsg 
                            from MnemonicCodesView 
                            where mnemonicType = 'MOVEABLE_UNIT_CLUSTER_FLAGS' 
                            order by idx" />
                            
    <VECTOR name="unitTypes">
      <ITEM value="EACH" />
      <ITEM value="KIT_BOX" />
    </VECTOR>

    <VECTOR name="masterZoneIds"
            loadSql = "select ' ' masterZoneId
                        union
                       select distinct masterZoneId 
                         from locationZones 
                        where (masterZoneId is not null or masterZoneId like 'REPLEN.%') 
                        order by masterZoneId" />

    <VECTOR name = "operators1"> 
       <ITEM value = " =" />
       <ITEM value = "like" />
    </VECTOR>

    <VECTOR name = "operators2"> 
       <ITEM value = " =" />
       <ITEM value = "&lt;" />
       <ITEM value = "&lt;=" />
       <ITEM value = "&lt;&gt;" />
       <ITEM value = "&gt;" />
       <ITEM value = "&gt;=" />
    </VECTOR>
    
    <VECTOR name = "operatorIn"> 
       <ITEM value = "in" />
       <ITEM value = "out" />
    </VECTOR>
    
    <TABLECOLUMN name = "classColors"  >
    </TABLECOLUMN>
    
  </GLOBAL_DEFINITIONS>

  <REPORTS preview = "true" records = "1000">
    <DBCONNECT type = "global" />
  </REPORTS>

  <TABPANE>
    <TAB title= "Eaches">
      <SPLITPANE divider="160">
        <FLEXSQLMODIFIERCOMPONENT
          name="EachesFilter"
          appendAsAnd="false"
          makeAbsolute="true"
          autoResize="false"
          autoExecute="true"
          labelsOnTop="true"
          maxFilterRows="6"
          editorWidth="130"
          showCheckBoxes="false"
          filterBorderText="Filter Criteria"
          filterBorderColor="blue"
          okButtonText="Execute"
          passiveMode="false"
          orientation="vertical">

          <DBCONNECT
            type="global"
            connectionId="epicor" />

          <FILTER_OPTION
            label="Unit"
            editorType="text"
            autoQuote="true" />

          <FILTER_OPTION
            label="UnitType"
            editorType="combo"
            autoQuote="true">
            <COMBO_OPTIONS
              ifdef="unitTypes"
              loadEmptyItem="true" />
          </FILTER_OPTION>

          <FILTER_OPTION
            label="MasterZoneId"
            editorType="combo"
            autoQuote="true">
            <COMBO_OPTIONS
              ifdef="masterZoneIds"
              loadEmptyItem="false" />
          </FILTER_OPTION>

          <FILTER_OPTION
            label="ZoneId"
            editorType="text"
            autoQuote="true">
          </FILTER_OPTION>

          <FILTER_OPTION
            label="LocationId"
            editorType="text"
            autoQuote="true" />

          <FILTER_OPTION
            label="StorageId"
            editorType="text"
            autoQuote="true" />

        </FLEXSQLMODIFIERCOMPONENT>
        
        <SPLITPANE divider = "150" 
                   orientation = "vertical">
          <FLEXTABLECOMPONENT name = "InventoryTable" 
                              init = "init" 
                              greenbar = "true"
                              refresh = "true"
                              refreshOnUpdate = "true"
                              refreshOnInsert = "true"
                              ignoreEventConcatenation = "true">
  
            <DBCONNECT type = "global" />
            <TRIGGER name = "EachesFilter" />
  
            <TABLE key = "EachesFilter:execute"
                   title = "Totals">
              <SELECT
                sql="&#xA;call InventoryReport(//Unit,
                     &#xA;                     //UnitType,
                     &#xA;                     //MasterZoneId,
                     &#xA;                     //ZoneId,
                     &#xA;                     //LocationId,
                     &#xA;                     //StorageId)" />
                                                  
              <TABLECOLUMNS>
                <TABLECOLUMN
                  name="Eaches"
                  preferredWidth="40"
                  align="right" />
                <TABLECOLUMN
                  name="AvailableQty"
                  preferredWidth="40"
                  align="right" />               
              </TABLECOLUMNS>
  
            </TABLE>
          </FLEXTABLECOMPONENT>

          <SPLITPANE divider = "190" 
                     orientation = "vertical">
            <FLEXTABLECOMPONENT name = "InventoryLowerTable" 
                                init = "init" 
                                greenbar = "true"
                                refresh = "true"
                                refreshOnUpdate = "true"
                                refreshOnInsert = "true"
                                records = "1000"
                                ignoreEventConcatenation = "true">
    
              <DBCONNECT type = "global" />
              <TRIGGER name = "InventoryTable" />
    
              <TABLE key = "InventoryTable:EachesFilter:execute"
                     title = "Totals by Location">
                <SELECT
                  sql="&#xA;call InventoryByLocations(//Unit,
                       &#xA;                          //UnitType,
                       &#xA;                          //MasterZoneId,
                       &#xA;                          //ZoneId,
                       &#xA;                          //LocationId,
                       &#xA;                          //StorageId)" />
    
                <TABLECOLUMNS>
                  <TABLECOLUMN
                    name="Unit"
                    preferredWidth="80"
                    maxWidth="100" />
                  <TABLECOLUMN
                    name="UnitType"
                    hide="true" />
                  <TABLECOLUMN
                    name="ZoneId"
                    preferredWidth="70" />
                  <TABLECOLUMN
                    name="LocationId"
                    preferredWidth="100" />
                  <TABLECOLUMN
                    name="LocDiscrepant"
                    preferredWidth="70"
                    maxWidth="70" />
                  <TABLECOLUMN
                    name="InvDiscrepant"
                    preferredWidth="70"
                    maxWidth="70" />
                  <TABLECOLUMN
                    name="InventoryCt"
                    preferredWidth="70"
                    maxWidth="70"
                    align="right" />
                  <TABLECOLUMN
                    name="EachQty"
                    preferredWidth="40"
                    align="right" />
                  <TABLECOLUMN
                    name="AvailableQty"
                    preferredWidth="60"
                    align="right" />
                </TABLECOLUMNS>
    
                <ALTVALUES>
                  <FIELD
                    name="LocDiscrepant"
                    ifdef="inventoryDiscrepantMap" />
                  <FIELD
                    name="InvDiscrepant"
                    ifdef="inventoryDiscrepantMap" />
                  <FIELD
                    name="Status"
                    ifdef="locationStatuses" />
                </ALTVALUES>
              </TABLE>
            </FLEXTABLECOMPONENT>
    
            <FLEXTABLECOMPONENT name = "InventoryBottomTable" 
                                init = "init" 
                                refresh = "true"
                                refreshOnUpdate = "true"
                                refreshOnInsert = "true"
                                greenbar = "true"
                                ignoreEventConcatenation = "true">
    
              <DBCONNECT type = "global" />
              <TRIGGER name = "InventoryLowerTable" />
          
 <!-- To add InsertInterpreter to a FlexTable, you need to add xml
 (after the FLEXTABLECOMPONENT tag but before the first <TABLE> tag -->
              <InsertInterpreter>
                <Field
                  name="Unit"
                  searchField="Unit"
                  searchTable="false"
                  searchParent="true" />
              </InsertInterpreter>
            
              <TABLE key = "InventoryLowerTable:InventoryTable:EachesFilter:execute"
                     title = "Details by Location">
                <SELECT
                  sql="&#xA;call InventoryReportDetail(//Unit,                
                       &#xA;                           //UnitType,
                       &#xA;                           //LocationId,
                       &#xA;                           //StorageId) " />

<!--  Do not want to allow inserts at this point - PJH    
                <INSERT sql = "call InvMaintCreateTubEx(//StorageId,
                                                        /*Unit,
                                                        /*UnitType,
                                                        '$QC_USER')" />
-->

<!--    
Removed 2016-01-24 Rich
Storage needs to be deleted using InvMaintUpdateEx                                                     
            <DELETE sql = "call LamiInvMaintDeleteEx(/*StorageId,
                                                     /*idx,
                                                    '$QC_USER')" />
-->

                <UPDATE
                  sql="&#xA;call InventoryAdjustment(/*StorageId,
                       &#xA;                         /*Idx,
                       &#xA;                         /*LocationId,
                       &#xA;                         /*Status,
                       &#xA;                         //Status,
                       &#xA;                         /*EachQty,
                       &#xA;                         //AdjQty,
                       &#xA;                         //ReasonCode,
                       &#xA;                         '$QC_USER',
                       &#xA;                         /*Lot,
                       &#xA;                         /*SerialNo)" />
    
                <TABLECOLUMNS>
                  <TABLECOLUMN
                    name="StorageId"
                    preferredWidth="70" />
                  <TABLECOLUMN
                    name="Idx"
                    preferredWidth="40"
                    align="right" />
                  <TABLECOLUMN
                    name="Unit"
                    preferredWidth="50" />
                  <TABLECOLUMN
                    name="UnitType"
                    preferredWidth="50"
                    hide="true" />
                  <TABLECOLUMN
                    name="PalletId"
                    preferredWidth="70" />
                  <TABLECOLUMN
                    name="Expiration"
                    preferredWidth="70"
                    maxWidth="70"
                    align="center" />
                  <TABLECOLUMN
                    name="Received"
                    preferredWidth="70"
                    maxWidth="70"
                    align="center" />
                  <TABLECOLUMN
                    name="Discrepant"
                    preferredWidth="70"
                    maxWidth="70" />
                  <TABLECOLUMN
                    name="EachQty"
                    preferredWidth="40"
                    align="right" />
                  <TABLECOLUMN
                    name="Lot"
                    hide="true" />
                  <TABLECOLUMN
                    name="SerialNo"
                    hide="true" />
                  <TABLECOLUMN
                    name="ReasonCode"
                    hide="true" />
                  <TABLECOLUMN
                    name="AdjQty"
                    hide="true" />
                </TABLECOLUMNS>
    
                <ALTVALUES>
                  <FIELD
                    name="Discrepant"
                    ifdef="inventoryDiscrepantMap" />
                  <FIELD
                    name="Status"
                    ifdef="inventoryStatusesMap" />
                  <FIELD
                    name="ReasonCode"
                    ifdef="inventoryAdjustmentCodesMap" />
                </ALTVALUES>

                <EDITOR
                  title="Edit"
                  dialogHeight="320"
                  saveText="Save"
                  restoreText="Restore"
                  cancelText="Cancel">
                  <FIELD name="StorageId">
                    <TEXTFIELD />
                  </FIELD>
                  <FIELD name="Idx">
                    <NUMERICFIELD />
                  </FIELD>
                  <FIELD name="Unit">
                    <TEXTFIELD />
                  </FIELD>
                  <FIELD name="Status">
                    <COMBO ifdef="inventoryStatuses" />
                  </FIELD>
                  <FIELD name="ReasonCode">
                    <COMBO ifdef="inventoryAdjustmentCodes" />
                  </FIELD>
                  <FIELD name="EachQty">
                    <NUMERICFIELD />
                  </FIELD>
                  <FIELD name="AdjQty">
                    <NUMERICFIELD />
                  </FIELD>
                </EDITOR>
              </TABLE>             
            </FLEXTABLECOMPONENT>
          </SPLITPANE>
        </SPLITPANE>
      </SPLITPANE>
    </TAB>
    
    <!--
      If the tab is not required, either set includeFlag = 0 or delete it.
      
      Receiving = 0x0020
      Inventory = 0x0008
      OPEX      = 0x0100
      -->
    <Include includeFlag = "0x0008"
             filename = "$SCREEN_CONFIG_DIR/MenuInventory/inventoryMaintTabPallets.xml"/>
    <Include includeFlag = "0x0008"
             filename = "$SCREEN_CONFIG_DIR/MenuInventory/inventoryMaintTabInventoryReport.xml"/>
    <Include includeFlag = "0x0020"
             filename = "$SCREEN_CONFIG_DIR/MenuInventory/inventoryMaintTabBlackholes.xml"/>
    <Include includeFlag = "0x0100"
             filename = "$SCREEN_CONFIG_DIR/MenuInventory/inventoryMaintTabOpexInputQueue.xml"/>
    <Include includeFlag = "0x0008"
             filename = "$SCREEN_CONFIG_DIR/MenuInventory/inventoryMaintTabDiscrepantInventory.xml"/>
    
  </TABPANE>
</FLEXSCREEN>
