<?xml version="1.0"?>
<!--DOCTYPE FLEXSCREEN SYSTEM "flexscreen.dtd" -->
<!--
  - COPYRIGHT (c) 2007 Queen City Software, Inc. All Rights Reserved.
  - No part of this copyrighted work may be reproduced, modified, or distributed
  - in any form or by any means without the prior written permission of Queen
  - City Software, Inc.
 -
 - $Id: inventoryAllocations.xml 9887 2018-03-07 18:58:07Z rlh $
 - Notes:
  -->

<FLEXSCREEN title = "Inventory Allocations" 
            height = "600" 
            width = "1000" 
            frametype = "internal"
            report = "true"
            updateSecurity = "inventoryAllocations" 
           >

  <!-- a dbConnect here is a universal connect object  -->
  <DBCONNECT type = "predefined" connectionId = "default" setglobal = "true"/>

  <GLOBAL_DEFINITIONS >
    <VECTORMAP name = "allocationStatuses"
               loadSql = "select idx, 
                                 returnCodeMsg 
                            from MnemonicCodesView 
                           where mnemonicType = 'ALLOCATION_STATUSES' 
                           order by idx" />

    <VECTORMAP name = "allocationMnemonics"
               loadSql = "select '', ''
                            from Dummy
                           union
                          select returnCodeMsg, 
                                 string(lpad(idx, 3, '0'))
                            from MnemonicCodesView 
                           where mnemonicType = 'ALLOCATION_STATUSES' 
                           order by 2" />
                           
                            
    <VECTORMAP name = "allocationFlags"
               loadSql = "select idx, 
                                 returnCodeMsg 
                            from MnemonicCodesView 
                           where mnemonicType = 'ALLOCATION_FLAGS' 
                           order by idx" />
  
    <VECTORMAP name = "zoneIds"
               loadSql = "select '', ''
                           union
                          select zoneId, 
                                 zoneId 
                            from LocationZones
                            where flags &amp; (gLocationZoneReserveFlag | gLocationZoneForwardPickFlag) > 0
                           order by 1" />

    <VECTORMAP name = "allocationTypes"> 
      <ITEM key = ""                   value = "" />
      <ITEM key = "Cyclecount"         value = "CYCLECOUNT" />
      <ITEM key = "Move_Get"           value = "MOVE_GET" />
      <ITEM key = "Move_Put"           value = "MOVE_PUT" />
      <ITEM key = "Pick"               value = "PICK" />
      <ITEM key = "Putaway"            value = "PUTAWAY" />
      <ITEM key = "Putaway_Source"     value = "PUTAWAY_SOURCE" />
      <ITEM key = "Replen"             value = "REPLEN" />
    </VECTORMAP>

    <VECTOR name = "operators1"> 
      <ITEM value = " =" />
      <ITEM value = "like" />
    </VECTOR>

    <VECTOR name = "operators2"> 
      <ITEM value = " =" />
      <ITEM value = "&lt;" />
      <ITEM value = "&lt;=" />
      <ITEM value = "&lt;&gt;" />
      <ITEM value = "&gt;" />
      <ITEM value = "&gt;=" />
    </VECTOR>
    
    <VECTOR name = "operatorIn"> 
      <ITEM value = "in" />
      <ITEM value = "out" />
    </VECTOR>
  </GLOBAL_DEFINITIONS>

  <REPORTS preview = "true" records = "1000">
    <DBCONNECT type = "global" />
  </REPORTS>

  <SPLITPANE  divider = "160" >
    <FLEXSQLMODIFIERCOMPONENT  name = "InventoryAllocationsFilter"
                               appendAsAnd = "false"
                               makeAbsolute = "true"
                               autoResize = "false"
                               autoExecute = "true"
                               labelsOnTop = "true"
                               maxFilterRows = "10"
                               editorWidth = "120"
                               showCheckBoxes = "false"
                               filterBorderText = "Filter Criteria"
                               filterBorderColor = "blue"
                               okButtonText = "Execute"
                               passiveMode = "false"
                               orientation = "vertical">

      <DBCONNECT type = "global" 
                 connectionId = "epicor" />                    

      <FILTER_OPTION label = "Date"
                     altValue = "date"
                     editorType = "calendar"
                     autoQuote = "true" >
        <CALENDAR_OPTIONS  pastEnabled = "true" 
                           deselectEnabled = "true"
                           monthsPast = "24" 
                           monthsFuture = "0"
                           format = "yyyy-MM-dd"/>
      </FILTER_OPTION>

      <FILTER_OPTION label = "AllocationId" 
                     altValue = "allocationId" 
                     editorType = "text" 
                     autoQuote = "true" />

      <FILTER_OPTION label = "Type"
                     altValue = "type"
                     editorType = "combo"
                     autoQuote = "true">
        <COMBO_OPTIONS ifdef = "allocationTypes"/>
      </FILTER_OPTION>
                     
      <FILTER_OPTION label = "WorkOrder" 
                     altValue = "workOrder" 
                     editorType = "text" 
                     autoQuote = "true" />
                     
      <FILTER_OPTION label = "Unit" 
                     altValue = "unit" 
                     editorType = "text" 
                     autoQuote = "true" />
                                            
      <FILTER_OPTION label = "UnitType" 
                     altValue = "unitType" 
                     editorType = "text" 
                     autoQuote = "true" />
                                            
      <FILTER_OPTION label = "Zone" 
                     altValue = "zoneId" 
                     editorType = "combo" 
                     autoQuote = "true">
        <COMBO_OPTIONS ifdef = "zoneIds" />
      </FILTER_OPTION>
                     
      <FILTER_OPTION label = "Location" 
                     altValue = "location" 
                     editorType = "text" 
                     autoQuote = "true" />
                     
      <FILTER_OPTION label = "Status"
                     altValue = "status"
                     editorType = "combo"
                     autoQuote = "true">
        <COMBO_OPTIONS ifdef = "allocationMnemonics"/>
      </FILTER_OPTION>
    </FLEXSQLMODIFIERCOMPONENT>

    <FLEXTABLECOMPONENT name = "InventoryAllocationsTable" 
                        init = "init" 
                        refresh = "true" 
                        greenbar = "true"
                        ignoreEventConcatenation = "true">

      <DBCONNECT type = "global" />
      <TRIGGER name = "InventoryAllocationsFilter" />

      <TABLE  key = "InventoryAllocationsFilter:execute" >
        <SELECT sql = "call AllocationScreenEx(//date, 
                                               //allocationId, 
                                               //type,
                                               //workOrder, 
                                               //unit,
                                               //unitType,
                                               //zoneId + '%',
                                               //location,
                                               //status)" />
                                               
        <TABLECOLUMNS>
          <TABLECOLUMN  name = "workOrderLineNo"  
                       align = "right" />
          <TABLECOLUMN name = "workOrderLineNoIdx"  
                       align = "right" />
           <TABLECOLUMN name = "qtyAllocated"  
                       align = "right" />
          <TABLECOLUMN name = "flags"  
                       align = "right" />
         </TABLECOLUMNS>
                     
        <ALTVALUES>
          <FIELD name = "flags" ifdef = "allocationFlags" />
          <FIELD name = "status" ifdef = "allocationStatuses" />
        </ALTVALUES>
      </TABLE>
    </FLEXTABLECOMPONENT>
  </SPLITPANE>
</FLEXSCREEN>
