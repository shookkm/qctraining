<?xml version="1.0"?>
<!--
   - Filename:     replenishment.xml
   - Description:
   -
   - (c) COPYRIGHT Queen City Software, Inc. 2016 All Rights Reserved
   - No part of this copyrighted work may be reproduced, modified, or
   - distributed in any form or by any means without the prior written
   - permission of Queen City Software, Inc.
   -
   - $Id: replenishment.xml 9887 2018-03-07 18:58:07Z rlh $
   - Notes:
  -->
<FLEXSCREEN title = "Replenishments &amp; Putaways"
            height = "500"
            width = "1050"
            frametype = "internal"
            updateSecurity = "replenishment.edit"
            insertSecurity = "replenishment.edit"
            deleteSecurity = "replenishment.edit" >

  <DBCONNECT type = "predefined"
             connectionId = "default"
             setglobal = "true"/>

  <GLOBAL_DEFINITIONS>
    <VECTORMAP name = "storageStates"
               loadSql = "select idx, returnCodeMsg
                            from MnemonicCodesView
                           where mnemonicType = 'STORAGE_STATES'
                           order by idx" />

    <VECTORMAP name = "storageStatus"
               loadSql = "select idx, returnCodeMsg
                            from MnemonicCodesView
                           where mnemonicType = 'STORAGE_STATUSES'
                           order by idx" />

    <VECTORMAP name = "inventoryStatus"
               loadSql = "select idx, returnCodeMsg
                            from MnemonicCodesView
                           where mnemonicType = 'INVENTORY_STATUSES'
                           order by idx" />

    <VECTORMAP name = "moveableUnitStatuses"
               loadSql = "select idx, returnCodeMsg
                            from MnemonicCodesView
                           where mnemonicType = 'REPLEN_MU_STATUSES'
                           order by idx" />

    <VECTORMAP name = "moveableUnitItemStatuses"
               loadSql = "select idx, returnCodeMsg
                            from MnemonicCodesView
                           where mnemonicType = 'REPLEN_MU_ITEM_STATUSES'
                           order by idx" />

    <VECTORMAP name = "workOrderStatuses"
               loadSql = "select idx, returnCodeMsg
                            from MnemonicCodesView
                           where mnemonicType = 'REPLEN_WO_STATUSES'
                              or mnemonicType = 'PUTAWAY_WO_STATUSES'
                           order by idx" />

    <VECTORMAP name = "workOrderStatusesByName"
               loadSql = "select '' as returnCodeMsg, '' idx
                          union
                          select returnCodeMsg, string(idx)
                            from MnemonicCodesView
                            where mnemonicType = 'REPLEN_WO_STATUSES'
                            order by idx" />

    <VECTORMAP name = "woPutawayStatusesByName"
               loadSql = "select '' as returnCodeMsg, '' idx
                          union
                          select returnCodeMsg, string(idx)
                            from MnemonicCodesView
                            where mnemonicType = 'PUTAWAY_WO_STATUSES'
                            order by idx" />

    <VECTORMAP name = "workOrderLineStatuses"
               loadSql = "select idx, returnCodeMsg
                            from MnemonicCodesView
                           where mnemonicType = 'REPLEN_WO_LINE_STATUSES'
                              or mnemonicType = 'PUTAWAY_WO_LINE_STATUSES'
                           order by idx" />

    <VECTOR name = "areas">
      <ITEM value = "" />
      <ITEM value = "OPEX.1" />
      <ITEM value = "PTL.ZN.01" />
      <ITEM value = "PTL.ZN.02" />
      <ITEM value = "PTL.ZN.03" />
      <ITEM value = "PTL.ZN.04" />
      <ITEM value = "PTL.ZN.05" />
      <ITEM value = "PTL.ZN.06" />
      <ITEM value = "PTL.ZN.07" />
      <ITEM value = "PTL.ZN.08" />
    </VECTOR>

    <VECTOR name = "operators1">
      <ITEM value = " =" />
      <ITEM value = "like" />
    </VECTOR>

    <VECTOR name = "operators2">
      <ITEM value = " =" />
      <ITEM value = "&lt;&gt;" />
    </VECTOR>

  </GLOBAL_DEFINITIONS>

  <TABPANE>
    <TAB title = "Replens" foreground = "red">
      <SPLITPANE  divider = "135" orientation = "vertical" >

        <FLEXSQLMODIFIERCOMPONENT  name = "ReplenFilter"
                                   appendAsAnd = "false"
                                   makeAbsolute = "true"
                                   autoResize = "false"
                                   autoExecute = "true"
                                   labelsOnTop = "false"
                                   maxFilterRows = "4"
                                   editorWidth = "200"
                                   showCheckBoxes = "false"
                                   filterBorderText = "Filter Criteria"
                                   filterBorderColor = "blue"
                                   okButtonText = "Execute"
                                   passiveMode = "true"
                                   orientation = "horizontal"
                                   roundedCorners = "true" >

          <DBCONNECT type = "global" connectionId = "epicor" />


          <FILTER_OPTION label = "Replen ID"
                          altValue = "workOrder"
                          editorType = "text"
                          autoQuote = "true"/>

          <FILTER_OPTION label = "Status"
                          altValue = "status"
                          editorType = "combo"
                          autoQuote = "true">
            <COMBO_OPTIONS ifdef = "workOrderStatusesByName" />
          </FILTER_OPTION>

          <FILTER_OPTION label = "ReferenceNo"
                          altValue = "referenceNo"
                          editorType = "text"
                          autoQuote = "true"/>

          <FILTER_OPTION label = "SKU"
                          altValue = "sku"
                          editorType = "text"
                          autoQuote = "true"/>

          <FILTER_OPTION label = "Area"
                          altValue = "area"
                          editorType = "combo"
                          autoQuote = "true">
            <COMBO_OPTIONS ifdef = "areas" />
          </FILTER_OPTION>

          <FILTER_OPTION label = "Location"
                          altValue = "locationId"
                          editorType = "text"
                          autoQuote = "true"/>

          <FILTER_OPTION label = "From Date"
                          altValue = "fromDate"
                          editorType = "calendar"
                          autoQuote = "true">
            <CALENDAR_OPTIONS  pastEnabled = "true" deselectEnabled = "true"
                               monthsPast = "6" monthsFuture = "0"
                               format = "yyyy-MM-dd"/>
          </FILTER_OPTION>

          <FILTER_OPTION label = "To Date"
                          altValue = "toDate"
                          editorType = "calendar"
                          autoQuote = "true">
            <CALENDAR_OPTIONS  pastEnabled = "true" deselectEnabled = "true"
                               monthsPast = "6" monthsFuture = "0"
                               format = "yyyy-MM-dd"/>
          </FILTER_OPTION>
        </FLEXSQLMODIFIERCOMPONENT>

        <SPLITPANE divider = "200" orientation = "horizontal" >
          <FLEXLISTCOMPONENT name = "WorkList"
                             greenbar = "true"
                             log = "true">

            <DBCONNECT type = "global" />

            <!-- name of component being listened to -->
            <TRIGGER name = "ReplenFilter" />

            <LIST key = "ReplenFilter:execute"
                  title = "Work Orders"
                  icon = "workorder.gif"
                  color = "red" >
              <SELECT sql = "Call ReplenStatusScreen(//workOrder,
                                                     //status,
                                                     '',
                                                     //sku,
                                                     //locationId,
                                                     //fromDate,
                                                     //toDate,
                                                     'w.status, w.workOrderId',
                                                     0)" />
            </LIST>
          </FLEXLISTCOMPONENT>

          <!--
             - Work Order
            -->
          <TABPANE tabplacement = "top">
            <TAB  title = "Orders" >
              <!-- every flex component has a name which is needed for referencing and attaching listeners-->
              <FLEXTABLECOMPONENT name = "StatusTable"
                                  greenbar = "true"
                                  log = "true">
                <DBCONNECT type = "global" />

                <!-- name of component being listened to -->
                <TRIGGER name = "WorkList" />

                <TABLE key = "WorkList" >
                  <SELECT sql = "Select w.workOrderId 'Replen ID',
                                        w.Priority,
                                        FlagDisplayer('WORK_ORDER_FLAGS', w.flags) Flags,
                                        w.Status,
                                        dateformat(ReceivedTs, gDateTimeFormat) ReceivedTs,
                                        dateformat(CompleteTs, gDateTimeFormat) CompleteTs,
                                        dateformat(Ts, gDateTimeFormat) Ts
                                   from WorkOrders w
                                   where w.workOrderId = //WorkList "/>

                  <DELETE sql = "delete from WorkOrders Where workOrderId = //WorkList "/>
                  <UPDATE sql = "update WorkOrders
                                   set priority = //Priority,
                                       status = //Status
                                   Where workOrderId = //WorkList "/>

                  <TABLECOLUMNS>
                    <TABLECOLUMN name = "Priority"
                                 align = "right" />
                  </TABLECOLUMNS>

                  <ALTVALUES>
                    <FIELD name = "Status" ifdef = "workOrderStatuses" />
                  </ALTVALUES>
                </TABLE>
              </FLEXTABLECOMPONENT>
            </TAB>

            <!--
               - WORK ORDER LINES tab
              -->
            <TAB  title = "Lines">
              <SPLITPANE divider = "80"
                         orientation = "vertical" >
                <FLEXTABLECOMPONENT name = "LinesTableUpper" greenbar = "true" log = "true">
                  <DBCONNECT type = "global" />
                  <TRIGGER name = "WorkList" />

                  <TABLE key = "WorkList" >
                    <SELECT sql = "Select l.workOrderId Replen_ID,
                                          l.LineNo,
                                          l.Unit,
                                          l.UnitType,
                                          l.QtyRequired,
                                          l.sourceLocationId GetLocation,
                                          l.destinationLocationId PutLocation,
                                          l.Status,
                                          FlagDisplayer('WORK_ORDER_LINE_FLAGS', l.flags) Flags,
                                          dateformat(l.CompletedTs, gDateTimeFormat) CompletedTs,
                                          dateformat(l.Ts, gDateTimeFormat) Ts
                                     from WorkOrders w
                                     join WorkOrderLines l
                                    where l.workOrderId = //WorkList
                                    order by Unit, l.LineNo "/>

                    <UPDATE sql = "update WorkOrderLines
                                               set Status = //Status
                                               where workOrderId = //Replen_ID
                                                 and lineNo = //LineNo"/>

                    <TABLECOLUMNS>
                      <TABLECOLUMN name = "Replen_ID"
                                   preferredWidth = "100" />
                      <TABLECOLUMN index = "GetLocation"
                                   preferredWidth = "120" />
                      <TABLECOLUMN index = "PutLocation"
                                   preferredWidth = "120" />
                      <TABLECOLUMN name = "LineNo"
                                   align = "right" />
                      <TABLECOLUMN name = "QtyRequired"
                                   align = "right" />
                    </TABLECOLUMNS>

                    <ALTVALUES>
                      <FIELD name = "Status" ifdef = "workOrderLineStatuses" />
                    </ALTVALUES>
                  </TABLE>
                </FLEXTABLECOMPONENT>

                <!--
                   - Lower Panel
                  -->
                <FLEXTABLECOMPONENT name = "LinesTableLower" greenbar = "true" log = "true">
                  <DBCONNECT type = "global" />
                  <TRIGGER name = "LinesTableUpper" />

                  <TABLE key = "LinesTableUpper:WorkList"  title = "Line Item Details">
                    <SELECT sql = "Select LineNo,
                                          Idx,
                                          Qty,
                                          QtyCompleted,
                                          OperatorId,
                                          ZoneId,
                                          LocationId,
                                          StorageId,
                                          MoveableUnitId,
                                          Status,
                                          FlagDisplayer('REPLEN_WO_LINE_FLAGS', flags) Flags,
                                          dateformat(Ts, gDateTimeFormat) Ts
                                     from WorkOrderLineOperations
                                    where workOrderId = //Replen_ID
                                      and lineNo = //LineNo
                                    order by idx" />

                    <UPDATE sql = "update WorkOrderLineOperations
                                     set QtyCompleted = //QtyCompleted,
                                         Status = //Status
                                     where workOrderId = //Replen_ID
                                       and lineNo = //LineNo
                                       and idx = //Idx"/>

                    <TABLECOLUMNS>
                      <TABLECOLUMN name = "LineNo"
                                   align = "right" />
                      <TABLECOLUMN name = "Idx"
                                   align = "right" />
                      <TABLECOLUMN name = "Qty"
                                   align = "right" />
                      <TABLECOLUMN name = "QtyCompleted"
                                   align = "right" />
                    </TABLECOLUMNS>

                    <ALTVALUES>
                      <FIELD name = "Status" ifdef = "workOrderLineStatuses" />
                    </ALTVALUES>
                  </TABLE>
                </FLEXTABLECOMPONENT>
              </SPLITPANE>
            </TAB>

            <TAB title ="Totes">
              <FLEXTABLECOMPONENT name = "ReplenTubs"
                                  greenbar = "true"
                                  log = "true">
                <DBCONNECT type = "global" />
                <TRIGGER name = "WorkList" />

                <TABLE key = "WorkList"
                       title = "Totes">
                  <SELECT sql = "Select distinct s.StorageId,
                                        s.LocationId,
                                        s.State,
                                        s.status  StorageStatus,
                                        i.Unit,
                                        i.UnitType,
                                        i.Qty     InvQty,
                                        i.status  InventoryStatus,
                                        dateformat(i.Ts, gDateTimeFormat) Ts
                                   from WorkOrderLineOperations o
                                   join Storage s
                                     on o.storageId = s.storageId
                                   join inventory i
                                  where o.workOrderId = //WorkList
                                  order by s.StorageId" />

                    <TABLECOLUMNS>
                      <TABLECOLUMN name = "StorageId"
                                   maxWidth = "160"
                                   preferredWidth = "140" />
                      <TABLECOLUMN name = "LocationId"
                                   maxWidth = "70"
                                   preferredWidth = "70" />
                      <TABLECOLUMN name = "Unit"
                                   maxWidth = "60"
                                   preferredWidth = "60" />
                      <TABLECOLUMN name = "UnitType"
                                   maxWidth = "60"
                                   preferredWidth = "60" />
                      <TABLECOLUMN name = "State"
                                   maxWidth = "80"
                                   preferredWidth = "80" />
                      <TABLECOLUMN name = "InvQty"
                                   align = "right"
                                   maxWidth = "50"
                                   preferredWidth = "50" />
                    </TABLECOLUMNS>

                  <ALTVALUES>
                    <FIELD name = "State"           ifdef = "storageStates" />
                    <FIELD name = "StorageStatus"   ifdef = "storageStatus" />
                    <FIELD name = "InventoryStatus" ifdef = "inventoryStatus" />
                  </ALTVALUES>
                </TABLE>
              </FLEXTABLECOMPONENT>
            </TAB>
          </TABPANE>
        </SPLITPANE>
      </SPLITPANE>
    </TAB>

    <TAB title = "Replen Log"
         foreground = "blue">
      <SPLITPANE divider = "300"
                 orientation = "vertical" >
        <FLEXTABLECOMPONENT name = "ReplenLog"
                            init = "replenLogInit"
                            refresh = "true"
                            refreshOnUpdate = "true"
                            greenbar = "true"
                            log = "true">
          <DBCONNECT type = "global" />

          <!-- name of component being listened to -->
          <TRIGGER name = "replenLogInit" />

          <TABLE key = "replenLogInit" >
            <SELECT sql = "Select *
                             from OpenReplenLogView
                             order by PutZone"/>

              <TABLECOLUMNS>
                <TABLECOLUMN name = "WorkOrderId"
                             preferredWidth = "100" />
                <TABLECOLUMN name = "CreatedTs"
                             preferredWidth = "60" />
                <TABLECOLUMN name = "Unit"
                             maxWidth = "80"
                             preferredWidth = "80" />
                <TABLECOLUMN name = "GetZones"
                             maxWidth = "80"
                             preferredWidth = "80" />
                <TABLECOLUMN name = "GetLines"
                             align = "right"
                             maxWidth = "60"
                             preferredWidth = "60" />
                <TABLECOLUMN name = "GetQty"
                             align = "right"
                             maxWidth = "50"
                             preferredWidth = "50" />
                <TABLECOLUMN name = "PutZone"
                             maxWidth = "80"
                             preferredWidth = "80" />
                <TABLECOLUMN name = "PutLines"
                             align = "right"
                             maxWidth = "60"
                             preferredWidth = "60" />
                <TABLECOLUMN name = "PutQty"
                             align = "right"
                             maxWidth = "50"
                             preferredWidth = "50" />
              </TABLECOLUMNS>
            <ALTVALUES>
            </ALTVALUES>
          </TABLE>
        </FLEXTABLECOMPONENT>

        <TABPANE>
          <TAB title = "Gets">
            <FLEXTABLECOMPONENT name = "ReplenLogGets"
                                refresh = "true"
                                refreshOnUpdate = "true"
                                greenbar = "true"
                                log = "true">
              <DBCONNECT type = "global" />

              <!-- name of component being listened to -->
              <TRIGGER name = "ReplenLog" />

              <TABLE key = "ReplenLog:replenLogInit" >
                <SELECT sql = "select substring(o.zoneId, 1, 9) ZoneId,
                                      o.Locationid,
                                      o.qty CaseQty,
                                      sum(o.Qty) TotalQty,
                                      list(o.StorageId order by o.StorageId) Cartons
                                 from WorkOrders w
                                 join WorkOrderLines l
                                 join WorkOrderLineOperations o
                                 where w.workOrderId = //WorkOrderId
                                   and o.status = gWoLineReplenGetPlanned
                                 group by ZoneId,
                                          o.LocationId,
                                          CaseQty
                                 order by o.LocationId"/>

                  <TABLECOLUMNS>
                    <TABLECOLUMN name = "ZoneId"
                                 maxWidth = "80"
                                 preferredWidth = "80" />
                    <TABLECOLUMN name = "LocationId"
                                 maxWidth = "80"
                                 preferredWidth = "80" />
                    <TABLECOLUMN name = "TotalQty"
                                 align = "right"
                                 maxWidth = "50"
                                 preferredWidth = "50" />
                    <TABLECOLUMN name = "CaseQty"
                                 align = "right"
                                 maxWidth = "50"
                                 preferredWidth = "50" />
                  </TABLECOLUMNS>
                <ALTVALUES>
                </ALTVALUES>
              </TABLE>
            </FLEXTABLECOMPONENT>
          </TAB>

          <TAB title = "Puts">
            <FLEXTABLECOMPONENT name = "ReplenLogPuts"
                                refresh = "true"
                                refreshOnUpdate = "true"
                                greenbar = "true"
                                log = "true">
              <DBCONNECT type = "global" />

              <!-- name of component being listened to -->
              <TRIGGER name = "ReplenLog" />

              <TABLE key = "ReplenLog:replenLogInit" >
                <SELECT sql = "select substring(o.zoneId, 1, 9) ZoneId,
                                      o.Locationid,
                                      o.Qty CaseQty,
                                      sum(o.Qty) TotalQty,
                                      list(o.StorageId order by o.StorageId) Cartons
                                 from WorkOrders w
                                 join WorkOrderLines l
                                 join WorkOrderLineOperations o
                                 where w.workOrderId = //WorkOrderId
                                   and o.status = gWoLinePutawayPlanned
                                 group by ZoneId,
                                          o.LocationId,
                                          o.Qty
                                 order by o.LocationId"/>

                  <TABLECOLUMNS>
                    <TABLECOLUMN name = "ZoneId"
                                 maxWidth = "80"
                                 preferredWidth = "80" />
                    <TABLECOLUMN name = "LocationId"
                                 maxWidth = "80"
                                 preferredWidth = "80" />
                    <TABLECOLUMN name = "TotalQty"
                                 align = "right"
                                 maxWidth = "50"
                                 preferredWidth = "50" />
                    <TABLECOLUMN name = "CaseQty"
                                 align = "right"
                                 maxWidth = "50"
                                 preferredWidth = "50" />
                  </TABLECOLUMNS>
                <ALTVALUES>
                </ALTVALUES>
              </TABLE>
            </FLEXTABLECOMPONENT>
          </TAB>
        </TABPANE>
      </SPLITPANE>
    </TAB>

    <TAB title = "Putaways"
         foreground = "blue">
      <SPLITPANE  divider = "135" orientation = "vertical" >

        <FLEXSQLMODIFIERCOMPONENT  name = "PutawayFilter"
                                   appendAsAnd = "false"
                                   makeAbsolute = "true"
                                   autoResize = "false"
                                   autoExecute = "true"
                                   labelsOnTop = "false"
                                   maxFilterRows = "4"
                                   editorWidth = "200"
                                   showCheckBoxes = "false"
                                   filterBorderText = "Filter Criteria"
                                   filterBorderColor = "blue"
                                   okButtonText = "Execute"
                                   passiveMode = "true"
                                   orientation = "horizontal"
                                   roundedCorners = "true" >

          <DBCONNECT type = "global"
                     connectionId = "default" />

          <FILTER_OPTION label = "Putaway ID"
                          altValue = "workOrder"
                          editorType = "text"
                          autoQuote = "true"/>

          <FILTER_OPTION label = "Status"
                          altValue = "status"
                          editorType = "combo"
                          autoQuote = "true">
            <COMBO_OPTIONS ifdef = "woPutawayStatusesByName" />
          </FILTER_OPTION>

          <FILTER_OPTION label = "Tub"
                          altValue = "mu"
                          editorType = "text"
                          autoQuote = "true"/>

          <FILTER_OPTION label = "SKU"
                          altValue = "sku"
                          editorType = "text"
                          autoQuote = "true"/>

          <FILTER_OPTION label = "Location"
                          altValue = "locationId"
                          editorType = "text"
                          autoQuote = "true"/>

          <FILTER_OPTION label = "From Date"
                          altValue = "fromDate"
                          editorType = "calendar"
                          autoQuote = "true">
            <CALENDAR_OPTIONS  pastEnabled = "true" deselectEnabled = "true"
                               monthsPast = "6" monthsFuture = "0"
                               format = "yyyy-MM-dd"/>
          </FILTER_OPTION>

          <FILTER_OPTION label = "To Date"
                          altValue = "toDate"
                          editorType = "calendar"
                          autoQuote = "true">
            <CALENDAR_OPTIONS  pastEnabled = "true" deselectEnabled = "true"
                               monthsPast = "6" monthsFuture = "0"
                               format = "yyyy-MM-dd"/>
          </FILTER_OPTION>
        </FLEXSQLMODIFIERCOMPONENT>

        <SPLITPANE divider = "200" orientation = "horizontal" >
          <FLEXLISTCOMPONENT name = "PutawayList"
                             greenbar = "true"
                             log = "true">

            <DBCONNECT type = "global" />

            <!-- name of component being listened to -->
            <TRIGGER name = "PutawayFilter" />

            <LIST key = "PutawayFilter:execute"
                  title = "Work Orders"
                  icon = "workorder.gif"
                  color = "blue" >
              <SELECT sql = "Call PutawayStatusScreen(//workOrder,
                                                      //mu,
                                                      //sku,
                                                      //fromDate,
                                                      //toDate)" />
            </LIST>
          </FLEXLISTCOMPONENT>

          <!--
             - Work Order
            -->
          <TABPANE tabplacement = "top">
            <!--
               - ORDERS TAB
              -->
            <TAB  title = "Putaways" >
              <!-- every flex component has a name which is needed for referencing and attaching listeners-->
              <FLEXTABLECOMPONENT name = "PutawayWo"
                                  greenbar = "true"
                                  log = "true">
                <DBCONNECT type = "global" />

                <!-- name of component being listened to -->
                <TRIGGER name = "PutawayList" />

                <TABLE key = "PutawayList" >
                  <SELECT sql = "Select w.workOrderId 'Replen ID',
                                        w.Priority,
                                        FlagDisplayer('WORK_ORDER_FLAGS', w.flags) Flags,
                                        w.Status,
                                        w.ReceivedTs,
                                        w.CompleteTs,
                                        w.Ts
                                   from WorkOrders w
                                  where w.workOrderId = //PutawayList "/>

                  <DELETE sql = "delete from WorkOrders Where workOrderId = //PutawayList "/>
                  <UPDATE sql = "update WorkOrders set priority = //Priority Where workOrderId = //PutawayList "/>

                    <TABLECOLUMNS>
                       <TABLECOLUMN name = "Priority"
                                    align = "right" />
                    </TABLECOLUMNS>
                  <ALTVALUES>
                    <FIELD name = "Status" ifdef = "workOrderStatuses" />
                  </ALTVALUES>
                </TABLE>
              </FLEXTABLECOMPONENT>
            </TAB>

            <!--
               - WORK ORDER LINES tab
              -->
            <TAB  title = "Lines">
              <SPLITPANE divider = "80"
                         orientation = "vertical" >
                <FLEXTABLECOMPONENT name = "PutawayLinesTableUpper"
                                    greenbar = "true"
                                    log = "true">
                  <DBCONNECT type = "global" />
                  <TRIGGER name = "PutawayList" />

                  <TABLE key = "PutawayList" >
                    <SELECT sql = "Select l.workOrderId Putaway_ID,
                                          l.LineNo,
                                          l.Unit,
                                          l.UnitType,
                                          l.QtyRequired,
                                          l.sourceLocationId GetLocation,
                                          l.destinationLocationId PutLocation,
                                          l.Status,
                                          FlagDisplayer('WORK_ORDER_LINE_FLAGS', l.flags) Flags,
                                          l.Ts,
                                          l.CompletedTs
                                     from WorkOrders w
                                     join WorkOrderLines l
                                    where l.workOrderId = //PutawayList
                                    order by Unit, l.LineNo "/>
                    <TABLECOLUMNS>
                      <TABLECOLUMN name = "Putaway_ID"
                                   preferredWidth = "100" />
                      <TABLECOLUMN index = "ReceivedLocation"
                                   preferredWidth = "120" />
                       <TABLECOLUMN name = "LineNo"
                                    align = "right" />
                       <TABLECOLUMN name = "QtyRequired"
                                    align = "right" />
                    </TABLECOLUMNS>

                    <ALTVALUES>
                      <FIELD name = "Status" ifdef = "workOrderLineStatuses" />
                    </ALTVALUES>
                  </TABLE>
                </FLEXTABLECOMPONENT>

                <!--
                   - Lower Panel
                  -->
                <FLEXTABLECOMPONENT name = "PutawayLinesTableLower"
                                    greenbar = "true"
                                    log = "true">
                  <DBCONNECT type = "global" />
                  <TRIGGER name = "PutawayLinesTableUpper" />

                  <TABLE key = "PutawayLinesTableUpper:PutawayList"
                         title = "Line Item Details">
                    <SELECT sql = "Select LineNo,
                                          Idx,
                                          Qty,
                                          QtyCompleted,
                                          OperatorId,
                                          ZoneId,
                                          LocationId,
                                          StorageId,
                                          MoveableUnitId,
                                          Status,
                                          FlagDisplayer('REPLEN_WO_LINE_FLAGS', flags) Flags,
                                          Ts
                                     from WorkOrderLineOperations
                                    where workOrderId = //Putaway_ID
                                      and lineNo = //LineNo
                                    order by idx" />

                    <TABLECOLUMNS>
                      <TABLECOLUMN name = "OperatorId"
                                   hide = "true" />
                       <TABLECOLUMN name = "MoveableUnitId"
                                   hide = "true" />
                       <TABLECOLUMN name = "LineNo"
                                    align = "right" />
                       <TABLECOLUMN name = "Idx"
                                    align = "right" />
                       <TABLECOLUMN name = "Qty"
                                    align = "right" />
                       <TABLECOLUMN name = "QtyCompleted"
                                    align = "right" />
                       <TABLECOLUMN name = "OperatorId"
                                    hide = "true" />
                       <TABLECOLUMN name = "ToteId"
                                    hide = "true" />
                    </TABLECOLUMNS>

                    <ALTVALUES>
                      <FIELD name = "Status" ifdef = "workOrderLineStatuses" />
                    </ALTVALUES>
                  </TABLE>
                </FLEXTABLECOMPONENT>
              </SPLITPANE>
            </TAB>

            <TAB title ="Totes">
              <FLEXTABLECOMPONENT name = "PutawayTubs"
                                  greenbar = "true"
                                  log = "true">
                <DBCONNECT type = "global" />
                <TRIGGER name = "PutawayList" />

                <TABLE key = "PutawayList"
                       title = "Totes">
                  <SELECT sql = "Select distinct s.StorageId,
                                        s.LocationId,
                                        s.State,
                                        s.status  StorageStatus,
                                        i.Unit,
                                        i.UnitType,
                                        i.Qty     InvQty,
                                        i.status  InventoryStatus,
                                        i.Ts
                                   from WorkOrderLineOperations o
                                   join Storage s
                                     on o.storageId = s.storageId
                                   join inventory i
                                  where o.workOrderId = //PutawayList
                                  order by s.StorageId" />

                    <TABLECOLUMNS>
                      <TABLECOLUMN name = "StorageId"
                                   maxWidth = "120"
                                   preferredWidth = "120" />
                      <TABLECOLUMN name = "LocationId"
                                   maxWidth = "60"
                                   preferredWidth = "60" />
                      <TABLECOLUMN name = "State"
                                   maxWidth = "80"
                                   preferredWidth = "80" />
                      <TABLECOLUMN name = "InvQty"
                                   align = "right"
                                   maxWidth = "60"
                                   preferredWidth = "60" />
                    </TABLECOLUMNS>

                  <ALTVALUES>
                    <FIELD name = "State"           ifdef = "storageStates" />
                    <FIELD name = "StorageStatus"   ifdef = "storageStatus" />
                    <FIELD name = "InventoryStatus" ifdef = "inventoryStatus" />
                  </ALTVALUES>
                </TABLE>
              </FLEXTABLECOMPONENT>
            </TAB>
          </TABPANE>
        </SPLITPANE>
      </SPLITPANE>
    </TAB>


    <TAB title = "Putaway Log"
         foreground = "blue">
      <SPLITPANE divider = "300"
                 orientation = "vertical" >
        <FLEXTABLECOMPONENT name = "PutawayLog"
                            init = "putawayLogInit"
                            refresh = "true"
                            refreshOnUpdate = "true"
                            greenbar = "true"
                            log = "true">
          <DBCONNECT type = "global" />

          <!-- name of component being listened to -->
          <TRIGGER name = "putawayLogInit" />

          <TABLE key = "putawayLogInit" >
            <SELECT sql = "Select *
                             from OpenPutawayLogView
                             order by PutZone, CreatedTs"/>

              <TABLECOLUMNS>
                <TABLECOLUMN name = "WorkOrderId"
                             preferredWidth = "100" />
                <TABLECOLUMN name = "CreatedTs"
                             preferredWidth = "60" />
                <TABLECOLUMN name = "Unit"
                             maxWidth = "80"
                             preferredWidth = "80" />
                <TABLECOLUMN name = "GetZones"
                             maxWidth = "80"
                             preferredWidth = "80" />
                <TABLECOLUMN name = "GetLines"
                             align = "right"
                             maxWidth = "60"
                             preferredWidth = "60" />
                <TABLECOLUMN name = "GetQty"
                             align = "right"
                             maxWidth = "50"
                             preferredWidth = "50" />
                <TABLECOLUMN name = "PutZone"
                             maxWidth = "80"
                             preferredWidth = "80" />
                <TABLECOLUMN name = "PutLines"
                             align = "right"
                             maxWidth = "60"
                             preferredWidth = "60" />
                <TABLECOLUMN name = "PutQty"
                             align = "right"
                             maxWidth = "50"
                             preferredWidth = "50" />
              </TABLECOLUMNS>
            <ALTVALUES>
            </ALTVALUES>
          </TABLE>
        </FLEXTABLECOMPONENT>

        <FLEXTABLECOMPONENT name = "ReplenLogPuts"
                            refresh = "true"
                            refreshOnUpdate = "true"
                            greenbar = "true"
                            log = "true">
          <DBCONNECT type = "global" />

          <!-- name of component being listened to -->
          <TRIGGER name = "PutawayLog" />

          <TABLE key = "PutawayLog:putawayLogInit" >
            <SELECT sql = "with PutawayLogWo(zoneId,
                                              locationId,
                                              palletId) as
                            (
                              select substring(o.zoneId, 1, 9) ZoneId,
                                     o.Locationid,
                                     o.storageId PalletId
                                from WorkOrders w
                                join WorkOrderLines l
                                join WorkOrderLineOperations o
                                where w.workOrderId = //WorkOrderId
                                  and o.status = gWoLinePutawayPlanned
                                group by ZoneId,
                                         o.LocationId,
                                         o.storageId
                            ),
                            PalletDetails(palletId,
                                          locationId,
                                          cartonCt,
                                          totalQty,
                                          cartonList) as
                            (
                              select p.palletId,
                                     s.locationId,
                                     count(s.storageId) cartonCt,
                                     sum(i.qty) totalQty,
                                     list(s.storageId) cartonList
                                from PutawayLogWo p
                                join storage s
                                  on p.palletId = s.clusterId
                                join Inventory i
                                where s.storageUnitType is null
                                group by p.palletId,
                                         s.locationId
                            )
                            select p.ZoneId,
                                   d.locationId GetLocation,
                                   p.locationId PutLocation,
                                   p.PalletId,
                                   d.CartonCt,
                                   d.TotalQty,
                                   if(d.CartonList is not null) then
                                     d.CartonList
                                   else
                                     'Pallet is missing'
                                   endif CartonList
                              from PutawayLogWo p
                              left outer join PalletDetails d
                                on p.palletId = d.palletId"/>

            <TABLECOLUMNS>
              <TABLECOLUMN name = "ZoneId"
                           maxWidth = "80"
                           preferredWidth = "80" />
              <TABLECOLUMN name = "GetLocation"
                           maxWidth = "80"
                           preferredWidth = "80" />
              <TABLECOLUMN name = "PutLocation"
                           maxWidth = "80"
                           preferredWidth = "80" />
              <TABLECOLUMN name = "PalletId"
                           maxWidth = "80"
                           preferredWidth = "80" />
              <TABLECOLUMN name = "TotalQty"
                           align = "right"
                           maxWidth = "60"
                           preferredWidth = "60" />
              <TABLECOLUMN name = "CartonCt"
                           align = "right"
                           maxWidth = "60"
                           preferredWidth = "60" />
            </TABLECOLUMNS>

            <ALTVALUES>
            </ALTVALUES>
          </TABLE>
        </FLEXTABLECOMPONENT>
      </SPLITPANE>
    </TAB>
  </TABPANE>
</FLEXSCREEN>
