<?xml version="1.0"?>
<!--DOCTYPE FLEXSCREEN SYSTEM "flexscreen.dtd" -->
<!--
  - COPYRIGHT (c) 2007 Queen City Software, Inc. All Rights Reserved.
  - No part of this copyrighted work may be reproduced, modified, or distributed
  - in any form or by any means without the prior written permission of Queen
  - City Software, Inc.
  -->

<FLEXSCREEN title = "Physical Inventory WorkOrders"
            height = "500"
            width = "950"
            frametype = "internal"
            updateSecurity = "physicalInventoryScreen.edit"
            insertSecurity = "physicalInventoryScreen.edit"
            deleteSecurity = "physicalInventoryScreen.edit" >

  <DBCONNECT type = "predefined"
             connectionId = "default"
             setglobal = "true"/>

  <GLOBAL_DEFINITIONS>
    <VECTORMAP name = "workOrderStatusesByName"
               loadSql = "select '' returnCodeMsg, -1 idx
                          union
                          select returnCodeMsg, idx 
                          from MnemonicCodesView 
                          where mnemonicType = 'WORK_ORDER_STATUSES' 
                          and mnemonicCode in
                          ('CYCLE_COUNT_PLANNED',
                          'CYCLE_COUNT_STARTED',
                          'COMPLETE')
                          order by idx" />
 
    <VECTORMAP name = "physicalInventorys"
               loadSql = "select '' physicalInventoryName, '' tmp
                          union
                          select physicalInventoryName, physicalInventoryName 
                            from physicalInventory 
                            where datediff(month, startTs, now()) &lt; 6 
                            order by physicalInventoryName" />

    <VECTORMAP name = "workOrderStatuses"
               loadSql = "select idx, returnCodeMsg 
                            from MnemonicCodesView 
                            where mnemonicType = 'WORK_ORDER_STATUSES' 
                            order by idx" />

    <VECTORMAP name = "workOrderLineStatuses"
               loadSql = "select idx, returnCodeMsg 
                          from MnemonicCodesView 
                          where mnemonicType = 'WORK_ORDER_LINE_STATUSES' 
                          order by idx" />

    <VECTORMAP name = "workOrderLineFlags"
               loadSql = "select idx, returnCodeMsg 
                          from MnemonicCodesView 
                          where mnemonicType = 'WORK_ORDER_LINE_LINE_FLAGS' 
                          order by idx" />
                          

    <VECTOR name = "yesNoValues">
      <ITEM value = "N" />
      <ITEM value = "Y" />
    </VECTOR>

    <VECTOR name = "operators1">
      <ITEM value = " =" />
      <ITEM value = "like" />
    </VECTOR>

    <VECTOR name = "operators2">
      <ITEM value = " =" />
      <ITEM value = "&lt;&gt;" />
    </VECTOR>

    <VECTOR name = "operatorIn">
      <ITEM value = "in" />
      <ITEM value = "out" />
    </VECTOR>
  </GLOBAL_DEFINITIONS>

  <SPLITPANE  divider = "125" orientation = "vertical" >

    <FLEXSQLMODIFIERCOMPONENT  name = "PhysInvFilter"
                               appendAsAnd = "false"
                               makeAbsolute = "true"
                               autoResize = "false"
                               autoExecute = "true"
                               labelsOnTop = "false"
                               maxFilterRows = "4"
                               editorWidth = "200"
                               showCheckBoxes = "false"
                               filterBorderText = "Filter Criteria"
                               filterBorderColor = "blue"
                               okButtonText = "Execute"
                               passiveMode = "true"
                               orientation = "horizontal"
                               roundedCorners = "true" >

      <DBCONNECT type = "global" connectionId = "epicor" />


      <FILTER_OPTION label = "Physical Inventory"
                     altValue = "physicalInventory"
                     editorType = "combo"
                     autoQuote = "true" >

        <COMBO_OPTIONS ifdef = "physicalInventorys" />            
      </FILTER_OPTION>

      <FILTER_OPTION label = "WorkOrderId"
                     altValue = "workOrder"
                     editorType = "text"
                     autoQuote = "true" >
      </FILTER_OPTION>

      <FILTER_OPTION label = "Status"
                     altValue = "status"
                     editorType = "combo"
                     autoQuote = "true" >

        <COMBO_OPTIONS ifdef = "workOrderStatusesByName" />            
      </FILTER_OPTION>
       
      <FILTER_OPTION label = "Tray"
                     altValue = "mu"
                     editorType = "text"
                     autoQuote = "true" />

      <FILTER_OPTION label = "SKU"
                     altValue = "sku"
                     editorType = "text"
                     autoQuote = "true" />

      <FILTER_OPTION label = "Location"
                     altValue = "location"
                     editorType = "text"
                     autoQuote = "true" />

    </FLEXSQLMODIFIERCOMPONENT>
 
    <SPLITPANE divider = "200" orientation = "horizontal" >

      <FLEXLISTCOMPONENT name = "WorkList"
                         greenbar = "true"
                         log = "true">

        <DBCONNECT type = "global" />

        <!-- name of component being listened to -->
        <TRIGGER name = "PhysInvFilter" />

        <LIST key = "PhysInvFilter:execute"
              title = "Work Orders"
              icon = "workorder.gif" 
              color = "MEDIUM_GREEN" >
               
          <SELECT sql = "Call PhysicalInventoryScreen(//physicalInventory,
                                                      //workOrder,
                                                      //mu,
                                                      //sku,
                                                      //location,
                                                      //status,
                                                      0)" />
        </LIST>
      </FLEXLISTCOMPONENT>
        
      <TABPANE tabplacement = "top">
        <TAB  title = "Orders" >
          <!-- every flex component has a name which is needed for referencing and attaching listeners-->
          <FLEXTABLECOMPONENT name = "StatusTable" 
                              greenbar = "true" 
                              log = "true">
            <DBCONNECT type = "global" />

            <!-- name of component being listened to -->
            <TRIGGER name = "WorkList" />

            <TABLE key = "WorkList" >
              <SELECT sql = "Select w.workOrderId Task,
                                    w.status,
                                    w.receivedTs,
                                    w.completeTs,
                                    w.ts
                               from WorkOrders w
                              where w.workOrderId = //WorkList" />

              <ALTVALUES>
                <FIELD name = "status" ifdef = "workOrderStatuses" />
              </ALTVALUES>
            </TABLE>
          </FLEXTABLECOMPONENT>
        </TAB>
        
        <TAB  title = "Lines">
          <SPLITPANE divider = "200" orientation = "vertical" >
            <FLEXTABLECOMPONENT name = "LinesTableUpper" 
                                greenbar = "true" 
                                records = "1000"
                                log = "true">
              <DBCONNECT type = "global" />
              <TRIGGER name = "WorkList" />

              <TABLE key = "WorkList" >
                 <SELECT sql = "Select l.workOrderId Task,
                                        l.lineNo,
                                        l.unit SKU,
                                        l.sourceLocationId location,
                                        l.qtyRequired,
                                        l.status,
                                        FlagDisplayer('PHYSICAL_INV_WO_LINE_FLAGS', 
                                                      l.flags) flags,
                                        l.ts,
                                        l.completedTs
                                   from WorkOrders w join
                                        WorkOrderLines l
                                  where l.workOrderId = //WorkList
                                  order by lineNo "/>
                                 
                <ALTVALUES>
                  <FIELD name = "status" ifdef = "workOrderLineStatuses" />
                </ALTVALUES>
              </TABLE>
            </FLEXTABLECOMPONENT>            
            
            <FLEXTABLECOMPONENT name = "LinesTableLower" 
                                greenbar = "true" 
                                log = "true">
              <DBCONNECT type = "global" />
              <TRIGGER name = "LinesTableUpper" />

              <TABLE key = "LinesTableUpper:WorkList"  
                     title = "Line Item Details">
                <SELECT sql = "Select lineNo,
                                      idx,
                                      qty,
                                      qtyCompleted qtyCounted,
                                      locationId,
                                      zoneId,
                                      storageId,
                                      operatorId,
                                      status,
                                      FlagDisplayer('PHYSICAL_INV_WO_LINE_FLAGS',
                                                    flags) flags,
                                      ts
                                 from workOrderLineOperations
                                where workOrderId = //Task
                                  and lineNo = //lineNo
                                order by idx"/>

                <ALTVALUES>
                  <FIELD name = "flags" ifdef = "workOrderLineFlags" />
                  <FIELD name = "status" ifdef = "workOrderLineStatuses" />
                </ALTVALUES>
              </TABLE>
            </FLEXTABLECOMPONENT>
          </SPLITPANE>
        </TAB>    
      </TABPANE>
    </SPLITPANE>
   </SPLITPANE>     
</FLEXSCREEN>
