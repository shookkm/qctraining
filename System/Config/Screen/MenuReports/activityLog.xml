<?xml version="1.0"?>
<!--
   - Filename:     activityLog.xml
   - Description:
   -
   - (c) COPYRIGHT QC Software, LLC 2018 All Rights Reserved
   - No part of this copyrighted work may be reproduced, modified, or
   - distributed in any form or by any means without the prior written
   - permission of QC Software, LLC.
   -
   - $Id: activityLog.xml 10242 2018-06-06 19:46:47Z wlw $
   - Notes:
  -->
<FLEXSCREEN title     = "Activity Log"
            height    = "575"
            width     = "1000"
            frametype = "internal"
            report    = "false" >

  <!-- a dbConnect here is a universal connect object  -->
  <DBCONNECT type         = "predefined"
             connectionId = "default"
             setglobal    = "true"/>

  <GLOBAL_DEFINITIONS>

    <VECTORMAP name    = "activityCodes"
               loadSql = "SELECT returnCodeMsg, mnemonicCode
                            FROM MnemonicCodesView
                           WHERE mnemonicType = 'ACTIVITY_CODES'
                           ORDER BY returnCodeMsg" />

    <VECTOR name    = "codes"
            loadSql = "SELECT DISTINCT v.mnemonicCode
                         FROM MnemonicCodesView v
                         JOIN ActivityLog al
                           ON v.mnemonicCode = al.activityCode
                        WHERE mnemonicType = 'ACTIVITY_CODES'
                        ORDER BY mnemonicCode" />

    <VECTORMAP name = "cranesMap"
               loadSql = "select description, description
                            from cranes
                           order by description" />

    <VECTOR name = "cranes"
            loadSql = "select description
                         from cranes
                        order by description" />

    <VECTOR name = "operators1">
      <ITEM value = " = " />
      <ITEM value = "LIKE " />
    </VECTOR>

    <VECTOR name = "operators2">
      <ITEM value = " =" />
      <ITEM value = "&lt;" />
      <ITEM value = "&lt;=" />
      <ITEM value = "&lt;&gt;" />
      <ITEM value = "&gt;" />
      <ITEM value = "&gt;=" />
    </VECTOR>

    <VECTOR name = "operatorIn">
      <ITEM value = "in" />
      <ITEM value = "out" />
    </VECTOR>

  </GLOBAL_DEFINITIONS>

  <REPORTS preview = "true" records = "1000">
    <DBCONNECT type = "global" />
  </REPORTS>

  <SPLITPANE  divider = "245">
    <FLEXSQLMODIFIERCOMPONENT name              = "ActivityLogFilter"
                              appendAsAnd       = "false"
                              makeAbsolute      = "true"
                              autoResize        = "false"
                              autoExecute       = "true"
                              labelsOnTop       = "true"
                              maxFilterRows     = "10"
                              editorWidth       = "200"
                              showCheckBoxes    = "false"
                              filterBorderText  = "Filter Criteria"
                              filterBorderColor = "blue"
                              okButtonText      = "Execute"
                              passiveMode       = "false"
                              orientation       = "vertical"
                              roundedCorners    = "true">

      <DBCONNECT type = "global" />

      <FILTER_OPTION label      = "Activity Code"
                     altValue   = "activityCode"
                     editorType = "combo"
                     autoQuote  = "true">
        <COMBO_OPTIONS ifdef = "codes" loadEmptyItem = "true" />
      </FILTER_OPTION>

      <FILTER_OPTION label      = "WorkOrderId"
                     altValue   = "workOrderId"
                     editorType = "text"
                     autoQuote  = "true" />

      <FILTER_OPTION label      = "Unit"
                     altValue   = "SKU"
                     editorType = "text"
                     autoQuote  = "true" />

      <FILTER_OPTION label      = "StorageId"
                     altValue   = "StorageId"
                     editorType = "text"
                     autoQuote  = "true" />

      <FILTER_OPTION label      = "MoveableUnitId"
                     altValue   = "moveableUnitId"
                     editorType = "text"
                     autoQuote  = "true" />

      <FILTER_OPTION label      = "LocationId"
                     altValue   = "locationId"
                     editorType = "text"
                     autoQuote  = "true" />

      <FILTER_OPTION label      = "OperatorId"
                     altValue   = "operatorId"
                     editorType = "text"
                     autoQuote  = "true" />

      <FILTER_OPTION label      = "From Date"
                     altValue   = "FromDate"
                     editorType = "calendar"
                     autoQuote  = "true" >
        <CALENDAR_OPTIONS pastEnabled     = "true"
                          deselectEnabled = "true"
                          monthsPast      = "6"
                          monthsFuture    = "0"
                          format          = "yyyy-MM-dd"/>
      </FILTER_OPTION>

      <FILTER_OPTION label      = "To Date"
                     altValue   = "ToDate"
                     editorType = "calendar"
                     autoQuote  = "true" >
        <CALENDAR_OPTIONS pastEnabled     = "true"
                          deselectEnabled = "true"
                          monthsPast      = "6"
                          monthsFuture    = "0"
                          format          = "yyyy-MM-dd"/>
      </FILTER_OPTION>
    </FLEXSQLMODIFIERCOMPONENT>

    <SPLITPANE divider = "470" 
               orientation = "vertical">
      <FLEXTABLECOMPONENT name                     = "ActivityLogTable"
                          init                     = "init"
                          refresh                  = "true"
                          greenbar                 = "true"
                          records                  = "100"
                          ignoreEventConcatenation = "true">

        <DBCONNECT type = "global" />
        <TRIGGER name = "ActivityLogFilter" />
        <TABLE key   = "ActivityLogFilter:execute"
               title = "Totals">
          <SELECT sql = "CALL ActivityLogScreen(//activityCode,
                                                //workOrderId,
                                                //SKU,
                                                //StorageId,
                                                //moveableUnitId,
                                                //locationId,
                                                //operatorId,
                                                //FromDate,
                                                //ToDate)" />
          <ALTVALUES>
            <FIELD name = "ActivityCode" ifdef = "activityCodes" />
          </ALTVALUES>
        </TABLE>
      </FLEXTABLECOMPONENT>

      <FLEXTABLECOMPONENT name = "ActivityLogTableLower" 
                          greenbar = "true"
                          ignoreEventConcatenation = "true">

        <DBCONNECT type = "global" />
        <TRIGGER name = "ActivityLogTable" />

        <TABLE key = "ActivityLogTable:ActivityLogFilter:execute">
          <SELECT sql = "call ActivityLogScreenDetail(//ActivityCode,
                                                      //Idx)"/>
        </TABLE>
      </FLEXTABLECOMPONENT>
    </SPLITPANE>
  </SPLITPANE>
</FLEXSCREEN>
