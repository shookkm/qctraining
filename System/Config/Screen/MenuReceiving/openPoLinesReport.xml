<?xml version="1.0"?>
<!--
   - Filename:     openPoLinesReport.xml
   - Description:
   -
   - (c) COPYRIGHT Queen City Software, Inc. 2016 All Rights Reserved
   - No part of this copyrighted work may be reproduced, modified, or
   - distributed in any form or by any means without the prior written
   - permission of Queen City Software, Inc.
   -
   - $Id: openPoLinesReport.xml 9911 2018-03-15 14:20:24Z rlh $
   - Notes:
  -->
<FLEXSCREEN title = "Open PO Lines Reports"
            height = "600"
            width = "1200"
            frametype = "internal"
            report = "false"
            updateSecurity = "openPoLines.edit">

  <!-- a dbConnect here is a universal connect object  -->
  <DBCONNECT type = "predefined"
             connectionId = "default"
             setglobal = "true"/>

  <GLOBAL_DEFINITIONS>
    <VECTOR name = "Totals">
       <ITEM value = "false" />
       <ITEM value = "true" />
    </VECTOR>

    <VECTOR name = "operators1">
       <ITEM value = " =" />
       <ITEM value = "like" />
    </VECTOR>

    <VECTOR name = "operators2">
       <ITEM value = " =" />
       <ITEM value = "&lt;" />
       <ITEM value = "&lt;=" />
       <ITEM value = "&lt;&gt;" />
       <ITEM value = "&gt;" />
       <ITEM value = "&gt;=" />
    </VECTOR>

    <VECTOR name = "operatorIn">
       <ITEM value = "in" />
       <ITEM value = "out" />
    </VECTOR>

    <VECTORMAP name = "workOrderStatuses"
               loadSql = "select idx,
                                 returnCodeMsg
                            from MnemonicCodesView
                            where mnemonicType = 'ASN_WO_STATUSES'
                            order by idx" />

    <VECTORMAP name = "workOrderLineStatuses"
               loadSql = "select idx,
                                 returnCodeMsg
                            from MnemonicCodesView
                            where mnemonicType = 'ASN_WO_LINE_STATUSES'
                            order by idx" />

    <VECTORMAP name = "asnStatuses"
               loadSql = "select '' returnCodeMsg,
                                 '' idx
                          union
                          select returnCodeMsg,
                                 string(idx) idx
                            from MnemonicCodesView
                            where mnemonicType = 'ASN_WO_STATUSES'
                              and mnemonicCode in ('LOADED',
                                                   'RECEIVING')
                            order by idx" />
  </GLOBAL_DEFINITIONS>

  <REPORTS preview = "true" records = "1000">
  </REPORTS>

  <SPLITPANE  divider = "80" orientation = "vertical">
    <FLEXSQLMODIFIERCOMPONENT  name = "openPoFilters"
                               orientation = "horizontal"
                               appendAsAnd = "false"
                               makeAbsolute = "false"
                               autoResize = "false"
                               autoExecute = "true"
                               maxFilterRows = "2"
                               editorWidth = "120"
                               showCheckBoxes = "false"
                               filterBorderText = "Filter Criteria"
                               filterBorderColor = "blue"
                               okButtonText = "Execute"
                               passiveMode = "false">

      <DBCONNECT type = "global" connectionId = "default" />

     <FILTER_OPTION label = "From Date"
                     altValue = "fromMonth"
                     editorType = "calendar"
                     autoQuote = "true" >
        <CALENDAR_OPTIONS  pastEnabled = "true"
                           deselectEnabled = "true"
                           monthsPast = "6"
                           monthsFuture = "0"
                           format = "yyyy-MM-dd"/>
      </FILTER_OPTION>

      <FILTER_OPTION label = "To Date"
                     altValue = "toMonth"
                     editorType = "calendar"
                     autoQuote = "true" >
        <CALENDAR_OPTIONS  pastEnabled = "true"
                           deselectEnabled = "true"
                           monthsPast = "6"
                           monthsFuture = "0"
                           format = "yyyy-MM-dd"/>
      </FILTER_OPTION>

      <FILTER_OPTION label = "WorkOrderId"
                     altValue = "workOrderId"
                     editorType = "text"
                     autoQuote = "true" >
      </FILTER_OPTION>
      
      <FILTER_OPTION label = "SKU"
                     altValue = "sku"
                     editorType = "text"
                     autoQuote  = "true" />

      <FILTER_OPTION label = "PO Status"
                     altValue = "poStatus"
                     editorType = "combo"
                     autoQuote = "true" >
        <COMBO_OPTIONS ifdef = "asnStatuses" />
      </FILTER_OPTION>

      <FILTER_OPTION label = "Delivery Date"
                     altValue = "deliveryDate"
                     editorType = "calendar"
                     autoQuote = "true" >
        <CALENDAR_OPTIONS  pastEnabled = "true"
                           deselectEnabled = "true"
                           monthsPast = "6"
                           monthsFuture = "3"
                           format = "yyyy-MM-dd"/>
      </FILTER_OPTION>

    </FLEXSQLMODIFIERCOMPONENT>

    <SPLITPANE  divider = "240" orientation = "vertical">

      <FLEXTABLECOMPONENT name = "OpenPoTable"
                          init = "init"
                          refresh = "true"
                          refreshOnUpdate = "true"
                          greenbar = "true"
                          sortable = "true"
                          records = "1000"
                          ignoreEventConcatenation = "true">

        <DBCONNECT type = "global" />
        <TRIGGER name = "openPoFilters" />

        <TABLE key = "openPoFilters:execute"
               title = "PO Details">
          <FLEXTABLEHANDLER class = "com.qcsoftware.ui.asn.AsnOpenOrderFlexTableHandler"
                            select = "call PoWithOpenEx(//fromMonth,
                                                        //toMonth,
                                                        //workOrderId,
                                                        //poStatus,
                                                        //deliveryDate,
                                                        //SKU)"
                            poTable = "JacentPurchaseOrder" />
                            
          <TABLECOLUMNS>
             <TABLECOLUMN name = "Version"
                          align = "right"/>

             <TABLECOLUMN name = "ReceivedLines"
                          align = "right"/>

            <TABLECOLUMN name = "OpenLines"
                         align = "right"/>

            <TABLECOLUMN name = "DeliveryHour"
                         align = "right"/>
          </TABLECOLUMNS>

          <ALTVALUES>
            <FIELD name = "Status"
                   ifdef = "workOrderStatuses" />
          </ALTVALUES>

          <EDITOR title = "Edit" dialogHeight = "560"
                  saveText = "Save" restoreText = "Restore" cancelText = "Cancel" >
            <FIELD name = "DateCreated">
              <TEXTFIELD editable = "false"
                         background = "LIGHT_GRAY"/>
            </FIELD>
            <FIELD name = "WorkOrderId">
              <TEXTFIELD editable = "false"
                         background = "LIGHT_GRAY"/>
            </FIELD>
            <FIELD name = "Version">
              <NUMERICFIELD editable = "false"
                            background = "LIGHT_GRAY"/>
            </FIELD>
            <FIELD name = "Status">
              <COMBO>
                <COMBOITEM value="" />
                <COMBOITEM value="RECEIVED" />
                <COMBOITEM value="CANCELLED" />
              </COMBO>
            </FIELD>
            <FIELD name = "ReceivedLines">
              <NUMERICFIELD editable = "false"
                            background = "LIGHT_GRAY"/>
            </FIELD>
            <FIELD name = "OpenLines">
              <NUMERICFIELD editable = "false"
                            background = "LIGHT_GRAY"/>
            </FIELD>
            <FIELD name = "LastUpdate">
              <TEXTFIELD editable = "false"
                         background = "LIGHT_GRAY"/>
            </FIELD>
            <FIELD name = "VendorName">
              <TEXTFIELD editable = "false"
                         background = "LIGHT_GRAY"/>
            </FIELD>
            <FIELD name = "BuyerName">
              <TEXTFIELD editable = "false"
                         background = "LIGHT_GRAY"/>
            </FIELD>
            <FIELD name = "DeliveryDate">
              <CALENDAR_COMBO
                name="calDeliveryDate"
                date="null"
                format="yyyy-MM-dd"
                pastEnabled="false"
                deselectEnabled="true" />
            </FIELD>
            <FIELD name = "DeliveryHour">
              <COMBO>
                <COMBOITEM value="" />
                <COMBOITEM value="0" />
                <COMBOITEM value="1" />
                <COMBOITEM value="2" />
                <COMBOITEM value="3" />
                <COMBOITEM value="4" />
                <COMBOITEM value="5" />
                <COMBOITEM value="6" />
                <COMBOITEM value="7" />
                <COMBOITEM value="8" />
                <COMBOITEM value="9" />
                <COMBOITEM value="10" />
                <COMBOITEM value="11" />
                <COMBOITEM value="12" />
                <COMBOITEM value="13" />
                <COMBOITEM value="14" />
                <COMBOITEM value="15" />
                <COMBOITEM value="16" />
                <COMBOITEM value="17" />
                <COMBOITEM value="18" />
                <COMBOITEM value="19" />
                <COMBOITEM value="20" />
                <COMBOITEM value="21" />
                <COMBOITEM value="22" />
                <COMBOITEM value="23" />
              </COMBO>
            </FIELD>
            <FIELD name = "PODate">
              <TEXTFIELD editable = "false"
                         background = "LIGHT_GRAY"/>
            </FIELD>
            <FIELD name = "CancelByDate">
              <TEXTFIELD editable = "false"
                         background = "LIGHT_GRAY"/>
            </FIELD>
          </EDITOR>
        </TABLE>
      </FLEXTABLECOMPONENT>

      <SPLITPANE  divider = "125" orientation = "vertical">

        <FLEXTABLECOMPONENT name = "OpenPoLinesTable"
                            init = "init"
                            refresh = "true"
                            refreshOnUpdate = "true"
                            greenbar = "true"
                            sortable = "true"
                            records = "1000"
                            ignoreEventConcatenation = "true">

          <DBCONNECT type = "global" />
          <TRIGGER name = "OpenPoTable" />

          <TABLE key = "OpenPoTable:openPoFilters:execute"
                 title = "Line Details">
	          <FLEXTABLEHANDLER class = "com.qcsoftware.ui.asn.AsnOpenLineFlexTableHandler"
	                            select = "Select l.WorkOrderId,
	                                             l.LineNo,
	 					                                   l.Unit,
	 					                                   l.QtyRequired,
						                                   sum(if(o.flags &amp; gAsnLineDamagedFlag = 0) then o.qtyCompleted else 0 endif) QtyReceived,
						                                   l.Status,
						                                   string(sum(if(o.flags &amp; gStorageLabelPrinted = gStorageLabelPrinted)then 1 else 0 endif)) + string('/') + string(count(*)) PrintStatus,
						                                   dateformat(l.ts, gDateTimeFormat) Ts
						                              from WorkOrderLines l
						                              join WorkOrderLineOperations o
						                             where l.WorkOrderId = //WorkOrderId
						                               and l.Status &lt; gAsnLineReceived
						                               and o.Status &lt; gAsnLineReceived
						                             group by l.WorkOrderId,l.LineNo, l.Unit, l.QtyRequired, l.Status, l.Ts
						                             order by l.LineNo" />

            <TABLECOLUMNS>

              <TABLECOLUMN name = "WorkOrderId"
                           hide = "true"/>
                           
              <TABLECOLUMN name = "LineNo"
                           align = "right"/>

              <TABLECOLUMN name = "QtyRequired"
                           align = "right"/>

              <TABLECOLUMN name = "QtyReceived"
                           align = "right"/>
            </TABLECOLUMNS>

             <ALTVALUES>
              <FIELD name = "Status"
                     ifdef = "workOrderLineStatuses" />
            </ALTVALUES>

            <EDITOR title = "Edit" dialogHeight = "320"
                    saveText = "Save" restoreText = "Restore" cancelText = "Cancel" >
              <FIELD name = "LineNo">
                <NUMERICFIELD editable = "false"
                              background = "LIGHT_GRAY"/>
              </FIELD>
              <FIELD name = "Unit">
                <TEXTFIELD editable = "false"
                           background = "LIGHT_GRAY"/>
              </FIELD>
              <FIELD name = "QtyRequired">
                <NUMERICFIELD editable = "false"
                              background = "LIGHT_GRAY"/>
              </FIELD>
              <FIELD name = "QtyReceived">
                <NUMERICFIELD editable = "false"
                              background = "LIGHT_GRAY"/>
              </FIELD>
              <FIELD name = "PrintStatus">
                <TEXTFIELD editable = "false"
                           background = "LIGHT_GRAY"/>
              </FIELD>
	            <FIELD name = "Status">
	              <COMBO>
	                <COMBOITEM value="" />
	                <COMBOITEM value="CANCELLED" />
	              </COMBO>
	            </FIELD>
              <FIELD name = "Ts">
                <TEXTFIELD editable = "false"
                           background = "LIGHT_GRAY"/>
              </FIELD>
            </EDITOR>
         </TABLE>
        </FLEXTABLECOMPONENT>

        <FLEXTABLECOMPONENT name = "OpenPoLinesOpsTable"
                            init = "init"
                            refresh = "true"
                            refreshOnUpdate = "true"
                            greenbar = "true"
                            sortable = "true"
                            records = "1000"
                            ignoreEventConcatenation = "true">

          <DBCONNECT type = "global" />
          <TRIGGER name = "OpenPoLinesTable" />

          <TABLE key = "OpenPoLinesTable:OpenPoTable:openPoFilters:execute"
                 title = "Line Operation Details">
            <FLEXTABLEHANDLER class = "com.qcsoftware.ui.asn.AsnOpenOpFlexTableHandler"
                              select = "Select l.WorkOrderId,
                                               o.LineNo,
 						                                   o.Idx,
 						                                   l.Unit,
 						                                   o.StorageId,
 						                                   o.Qty QtyRequired,
						                                   coalesce(o.QtyCompleted, 0) QtyReceived,
						                                   o.Status,
						                                   (if(o.flags &amp; gStorageLabelPrinted = gStorageLabelPrinted)then 'Y' else 'N' endif) PrintStatus,
						                                   dateformat(o.ts, gDateTimeFormat) Ts
						                              from WorkOrderLines l
						                              join WorkOrderLineOperations o
						                             where l.WorkOrderId = //WorkOrderId
						                               and o.LineNo = //LineNo
						                               and o.Status &lt; gAsnLineReceived
						                             order by o.LineNo, o.Idx" />

            <TABLECOLUMNS>

              <TABLECOLUMN name = "WorkOrderId"
                           hide = "true"/>

              <TABLECOLUMN name = "LineNo"
                           hide = "true"/>

              <TABLECOLUMN name = "Idx"
                           align = "right"/>

              <TABLECOLUMN name = "QtyRequired"
                           align = "right"/>

              <TABLECOLUMN name = "QtyReceived"
                           align = "right"/>
            </TABLECOLUMNS>

             <ALTVALUES>
              <FIELD name = "Status"
                     ifdef = "workOrderLineStatuses" />
            </ALTVALUES>

            <EDITOR title = "Edit" dialogHeight = "355"
                    saveText = "Save" restoreText = "Restore" cancelText = "Cancel" >
              <FIELD name = "Idx">
                <NUMERICFIELD editable = "false"
                              background = "LIGHT_GRAY"/>
              </FIELD> 
              <FIELD name = "Unit">
                <TEXTFIELD editable = "false"
                           background = "LIGHT_GRAY"/>
              </FIELD>
              <FIELD name = "StorageId">
                <TEXTFIELD editable = "false"
                           background = "LIGHT_GRAY"/>
              </FIELD>
              <FIELD name = "QtyRequired">
                <NUMERICFIELD editable = "false"
                              background = "LIGHT_GRAY"/>
              </FIELD>
              <FIELD name = "QtyReceived">
                <NUMERICFIELD editable = "false"
                              background = "LIGHT_GRAY"/>
              </FIELD>
              <FIELD name = "Status">
                <COMBO>
                  <COMBOITEM value="" />
                  <COMBOITEM value="RECEIVED" />
                  <COMBOITEM value="CANCELLED" />
                </COMBO>
              </FIELD>
              <FIELD name = "PrintStatus">
                <TEXTFIELD editable = "false"
                           background = "LIGHT_GRAY"/>
              </FIELD>
              <FIELD name = "Ts">
                <TEXTFIELD editable = "false"
                           background = "LIGHT_GRAY"/>
              </FIELD>
            </EDITOR>
         </TABLE>
        </FLEXTABLECOMPONENT>
      </SPLITPANE>
    </SPLITPANE>
  </SPLITPANE>
</FLEXSCREEN>
