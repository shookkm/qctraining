<?xml version="1.0"?>
<!--
   - Filename:     printers.xml
   - Description:
   -
   - (c) COPYRIGHT QC Software, LLC 2017 All Rights Reserved
   - No part of this copyrighted work may be reproduced, modified, or
   - distributed in any form or by any means without the prior written
   - permission of QC Software, LLC.
   -
   - $Id: printers.xml 10242 2018-06-06 19:46:47Z wlw $
   - Notes:
  -->
<FLEXSCREEN title = "Printers" height = "300" width = "800" frametype = "internal"
            updateSecurity = "printers.edit" insertSecurity = "printers.edit"
            deleteSecurity = "printers.edit" >

  <DBCONNECT type = "predefined" connectionId = "default" setglobal = "true"/>

  <GLOBAL_DEFINITIONS>
    <VECTOR name = "equipmentTypes"
            loadSql = "select description
                         from EquipmentTypes
                        where equipmentType like '%printer%'" />

    <VECTOR name = "equipmentStatuses"
            loadSql = "select returnCodeMsg
                         from MnemonicCodesView
                        where mnemonicType = 'EQUIPMENT_STATUSES'
                        order by mnemonicCode" />

    <VECTORMAP name = "equipmentTypeMap"
               loadSql = "select equipmentType, description
                            from EquipmentTypes
                           where equipmentType like '%printer%'" />

    <VECTORMAP name = "equipmentStatusMap"
               loadSql = "select idx, returnCodeMsg
                            from MnemonicCodesView
                           where mnemonicType = 'EQUIPMENT_STATUSES'
                           order by mnemonicCode" />

    <VECTORMAP name = "equipmentFlags"
               loadSql = "select returnCodeMsg, idx 
                            from MnemonicCodesView
                           where mnemonicType = 'EQUIPMENT_FLAGS'
                             and mnemonicCode in('OK', 'INDUCT_PRINTER', 'BATCH_LABEL_PRINTER')
                           order by idx" />
  </GLOBAL_DEFINITIONS>

  <FLEXTABLECOMPONENT name = "Printers"
                      init = "PrintersTable"
                      refresh = "true"
                      refreshOnUpdate = "true"
                      greenbar = "true"
                      log = "true" >

    <DBCONNECT type = "global" />

    <TABLE key="PrintersTable">

      <SELECT sql = "select e.id Id, e.equipmentType Type, e.hostId Host, e.Area, e.Status,
                            FlagDisplayer('EQUIPMENT_FLAGS', flags) Flags,
                            e.Flags FlagBits, e.AssignedToOperReferId LabelType, e.Description
                       from Equipment e
                      where equipmentType like '%Printer'
                      order by id"/>

      <INSERT sql = "call PrinterInsertEx(//Id, //Type, //Host, //Description, //FlagBits, //Area)" />
      
      <UPDATE sql = "Update Equipment
                        set status = //Status,
                            flags = //FlagBits,
                            area = //Area,
                            hostid = //Host,
                            assignedToOperReferId = //LabelType,
                            ts = now(*)
                      where id = //Id" />
                      
      <DELETE sql = "delete
                       from Equipment
                      where id = //Id" />

      <ALTVALUES>
        <FIELD name = "Type" ifdef = "equipmentTypeMap" />
        <FIELD name = "Status" ifdef = "equipmentStatusMap" />
      </ALTVALUES>
                
      <EDITOR restoreHide = "true" 
                    title = "Printer"
                 saveText = "Save" 
               cancelText = "Cancel">
               
        <FIELD name = "Id">
          <TEXTFIELD />
        </FIELD> 
        <FIELD name = "Type">
          <COMBO ifdef = "equipmentTypes" />
        </FIELD>
        <FIELD name = "Host">
          <TEXTFIELD />
        </FIELD> 
        <FIELD name = "Area">
          <TEXTFIELD />
        </FIELD> 
        <FIELD name = "Status">
          <COMBO ifdef = "equipmentStatuses" />
        </FIELD>
        <FIELD name = "FlagBits">
	  <POPUPBITVALUEEDITOR maxRows = "5">
	    <BIT_VALUES ifdef = "equipmentFlags" />
	  </POPUPBITVALUEEDITOR>
        </FIELD>
        <FIELD name = "LabelType">
          <TEXTFIELD />
        </FIELD>
        <FIELD name = "Description">
          <TEXTFIELD />
        </FIELD>
      </EDITOR>

      <TABLECOLUMNS>
        <TABLECOLUMN name = "FlagBits"  hide = "true" />
      </TABLECOLUMNS>
    </TABLE>

    <InsertInterpreter>
      <Field name = "FlagBits"
             searchField = ""
             defaultValue = "0"
             searchTable = "false"
             searchParent = "false"/>
    </InsertInterpreter>
  </FLEXTABLECOMPONENT>
</FLEXSCREEN>
